<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0">
    <channel>
        <title>QueryDSL - Category - ðŸ“š | Dev Blog</title>
        <link>https://jaeyeonme.github.io/categories/querydsl/</link>
        <description>QueryDSL - Category - ðŸ“š | Dev Blog</description>
        <generator>Hugo -- gohugo.io</generator><language>en</language><lastBuildDate>Sat, 01 Jan 2022 10:00:00 &#43;0000</lastBuildDate><atom:link href="https://jaeyeonme.github.io/categories/querydsl/" rel="self" type="application/rss+xml" /><item>
    <title>Spring Data JPAê°€ ì œê³µí•˜ëŠ” QueryDSL</title>
    <link>https://jaeyeonme.github.io/posts/spring-data-jpa-with-querydsl/</link>
    <pubDate>Sat, 01 Jan 2022 10:00:00 &#43;0000</pubDate>
    <author>Author</author>
    <guid>https://jaeyeonme.github.io/posts/spring-data-jpa-with-querydsl/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/images/JPA/querydsl.png" referrerpolicy="no-referrer">
            </div>1. ì¸í„°íŽ˜ì´ìŠ¤ ì§€ì› - QuerydslPredicateExecutor  ê³µì‹ URL : https://docs.spring.io/spring-data/jpa/docs/2.2.3.RELEASE/reference/html/#core.extensions.querydsl  QuerydslPredicateExecutor ì¸í„°íŽ˜ì´ìŠ¤
public interface QuerydslPredicateExecutor&lt;T&gt; { Optional&lt;T&gt; findById(Predicate predicate); Iterable&lt;T&gt; findAll(Predicate predicate); long count(Predicate predicate); boolean exists(Predicate predicate); // â€¦ more functionality omitted.  } 
ë¦¬í¬ì§€í† ë¦¬ì— ì ìš©
interface MemberRepository extends JpaRepository&lt;User, Long&gt;, QuerydslPredicateExecutor&lt;User&gt; { } Iterable result = memberRepository.findAll( member.age.between(10, 40) .and(member.username.eq(&#34;member1&#34;)) ); 
í•œê³„ì 
 ì¡°ì¸X (ë¬µì‹œì  ì¡°ì¸ì€ ê°€ëŠ¥í•˜ì§€ë§Œ left joinì´ ë¶ˆê°€ëŠ¥í•˜ë‹¤) í´ë¼ì´ì–¸íŠ¸ê°€ Querydslì— ì˜ì¡´í•´ì•¼ í•œë‹¤. ì„œë¹„ìŠ¤ í´ëž˜ìŠ¤ê°€ Querydsl ì´ë¼ëŠ” êµ¬í˜„ ê¸°ìˆ ì— ì˜ì¡´í•´ì•¼ í•œë‹¤. ë³µìž¡í•œ ì‹¤ë¬´í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ê¸°ì—ëŠ” í•œê³„ê°€ ëª…í™•í•˜ë‹¤.  ì°¸ê³ : QuerydslPredicateExecutor ëŠ” Pageable, Sortë¥¼ ëª¨ë‘ ì§€ì›í•˜ê³  ì •ìƒ ë™ìž‘í•œë‹¤.
2. Querydsl Web ì§€ì›  ê³µì‹ URL : https://docs.spring.io/spring-data/jpa/docs/2.2.3.RELEASE/reference/html/#core.web.type-safe  í•œê³„ì 
 ë‹¨ìˆœí•œ ì¡°ê±´ë§Œ ê°€ëŠ¥ ì¡°ê±´ì„ ì»¤ìŠ¤í…€í•˜ëŠ” ê¸°ëŠ¥ì´ ë³µìž¡í•˜ê³  ëª…ì‹œì ì´ì§€ ì•ŠìŒ ì»¨íŠ¸ë¡¤ëŸ¬ê°€ Querydslì— ì˜ì¡´ ë³µìž¡í•œ ì‹¤ë¬´í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ê¸°ì—ëŠ” í•œê³„ê°€ ëª…í™•  3. ë¦¬í¬ì§€í† ë¦¬ ì§€ì› - QuerydslRepositorySupport QuerydslRepositorySupport
ìž¥ì 
 getQuerydsl().applyPagination() ìŠ¤í”„ë§ ë°ì´í„°ê°€ ì œê³µí•˜ëŠ” íŽ˜ì´ì§•ì„ Querydslë¡œ íŽ¸ë¦¬í•˜ê²Œ ë³€í™˜ ê°€ëŠ¥(ë‹¨! SortëŠ” ì˜¤ë¥˜ë°œìƒ) from() ìœ¼ë¡œ ì‹œìž‘ ê°€ëŠ¥(ìµœê·¼ì—ëŠ” QueryFactoryë¥¼ ì‚¬ìš©í•´ì„œ select() ë¡œ ì‹œìž‘í•˜ëŠ” ê²ƒì´ ë” ëª…ì‹œì ) EntityManager ì œê³µ  í•œê³„
 Querydsl 3.x ë²„ì „ì„ ëŒ€ìƒìœ¼ë¡œ ë§Œë“¬ Querydsl 4.x ì— ë‚˜ì˜¨ JPAQueryFactoryë¡œ ì‹œìž‘í•  ìˆ˜ ì—†ìŒ  selectë¡œ ì‹œìž‘í•  ìˆ˜ ì—†ìŒ (fromìœ¼ë¡œ ì‹œìž‘í•´ì•¼ í•¨)   QueryFactory ë¥¼ ì œê³µí•˜ì§€ ì•ŠìŒ ìŠ¤í”„ë§ ë°ì´í„° Sort ê¸°ëŠ¥ì´ ì •ìƒ ë™ìž‘í•˜ì§€ ì•ŠìŒ  4. Querydsl ì§€ì› í´ëž˜ìŠ¤ ì§ì ‘ ë§Œë“¤ê¸° ìŠ¤í”„ë§ ë°ì´í„°ê°€ ì œê³µí•˜ëŠ” QuerydslRepositorySupport ê°€ ì§€ë‹Œ í•œê³„ë¥¼ ê·¹ë³µí•˜ê¸° ìœ„í•´ ì§ì ‘ QueryDSL ì§€ì› í´ëž˜ìŠ¤ë¥´ ë§Œë“¤ì–´ë³´ìž.
ìž¥ì 
 ìŠ¤í”„ë§ ë°ì´í„°ê°€ ì œê³µí•˜ëŠ” íŽ˜ì´ì§•ì„ íŽ¸ë¦¬í•˜ê²Œ ë³€í™˜ íŽ˜ì´ì§•ê³¼ ì¹´ìš´íŠ¸ ì¿¼ë¦¬ ë¶„ë¦¬ ê°€ëŠ¥ ìŠ¤í”„ë§ ë°ì´í„° Sort ì§€ì› select() , selectFrom() ìœ¼ë¡œ ì‹œìž‘ ê°€ëŠ¥ EntityManager , QueryFactory ì œê³µ  Querydsl4RepositorySupport /** * Querydsl 4.x ë²„ì „ì— ë§žì¶˜ Querydsl ì§€ì› ë¼ì´ë¸ŒëŸ¬ë¦¬ * * @author Yonghan Kim * org.springframework.data.jpa.repository.support.QuerydslRepositorySupport */ @Repository public abstract class Querydsl4RepositorySupport { private final Class domainClass; private Querydsl querydsl; private EntityManager entityManager; private JPAQueryFactory queryFactory; public Querydsl4RepositorySupport(Class&lt;?&gt; domainClass) { Assert.notNull(domainClass, &#34;Domain class must not be null!&#34;); this.domainClass = domainClass; } @Autowired public void setEntityManager(EntityManager entityManager) { Assert.notNull(entityManager, &#34;EntityManager must not be null!&#34;); JpaEntityInformation entityInformation = JpaEntityInformationSupport.getEntityInformation(domainClass, entityManager); SimpleEntityPathResolver resolver = SimpleEntityPathResolver.INSTANCE; EntityPath path = resolver.createPath(entityInformation.getJavaType()); this.entityManager = entityManager; this.querydsl = new Querydsl(entityManager, new PathBuilder&lt;&gt;(path.getType(), path.getMetadata())); this.queryFactory = new JPAQueryFactory(entityManager); } @PostConstruct public void validate() { Assert.notNull(entityManager, &#34;EntityManager must not be null!&#34;); Assert.notNull(querydsl, &#34;Querydsl must not be null!&#34;); Assert.notNull(queryFactory, &#34;QueryFactory must not be null!&#34;); } protected JPAQueryFactory getQueryFactory() { return queryFactory; } protected Querydsl getQuerydsl() { return querydsl; } protected EntityManager getEntityManager() { return entityManager; } protected &lt;T&gt; JPAQuery&lt;T&gt; select(Expression&lt;T&gt; expr) { return getQueryFactory().select(expr); } protected &lt;T&gt; JPAQuery&lt;T&gt; selectFrom(EntityPath&lt;T&gt; from) { return getQueryFactory().selectFrom(from); } protected &lt;T&gt; Page&lt;T&gt; applyPagination(Pageable pageable, Function&lt;JPAQueryFactory, JPAQuery&gt; contentQuery) { JPAQuery jpaQuery = contentQuery.apply(getQueryFactory()); List&lt;T&gt; content = getQuerydsl().applyPagination(pageable, jpaQuery).fetch(); return PageableExecutionUtils.getPage(content, pageable, jpaQuery::fetchCount); } protected &lt;T&gt; Page&lt;T&gt; applyPagination(Pageable pageable, Function&lt;JPAQueryFactory, JPAQuery&gt; contentQuery, Function&lt;JPAQueryFactory, JPAQuery&gt; countQuery) { JPAQuery jpaContentQuery = contentQuery.apply(getQueryFactory()); List&lt;T&gt; content = getQuerydsl().applyPagination(pageable, jpaContentQuery).fetch(); JPAQuery countResult = countQuery.apply(getQueryFactory()); return PageableExecutionUtils.getPage(content, pageable, countResult::fetchCount); } } 
Querydsl4RepositorySupport ì‚¬ìš© ì½”ë“œ @Repository public class MemberTestRepository extends Querydsl4RepositorySupport { public MemberTestRepository() { super(Member.class); } public List&lt;Member&gt; basicSelect() { return select(member) .from(member) .fetch(); } public List&lt;Member&gt; basicSelectFrom() { return selectFrom(member) .fetch(); } public Page&lt;Member&gt; searchPageByApplyPage(MemberSearchCondition condition, Pageable pageable) { JPAQuery&lt;Member&gt; query = selectFrom(member) .leftJoin(member.team, team) .where(usernameEq(condition.getUsername()), teamNameEq(condition.getTeamName()), ageGoe(condition.getAgeGoe()), ageLoe(condition.getAgeLoe()) ); List&lt;Member&gt; content = getQuerydsl().]]></description>
</item><item>
    <title>Spring Data JPAì™€ QueryDSL</title>
    <link>https://jaeyeonme.github.io/posts/spring-data-jpa-and-querydsl/</link>
    <pubDate>Sat, 01 Jan 2022 09:00:00 &#43;0000</pubDate>
    <author>Author</author>
    <guid>https://jaeyeonme.github.io/posts/spring-data-jpa-and-querydsl/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/images/JPA/querydsl.png" referrerpolicy="no-referrer">
            </div>ìŠ¤í”„ë§ ë°ì´í„° JPA ë¦¬í¬ì§€í† ë¦¬ë¡œ ë³€ê²½ ìŠ¤í”„ë§ ë°ì´í„° JPA - MemberRepository ìƒì„± package study.querydsl.repository; import org.springframework.data.jpa.repository.JpaRepository; import study.querydsl.entity.Member; import java.util.List; public interface MemberRepository extends JpaRepository&lt;Member, Long&gt; { // select m from m where m.username = ?;  List&lt;Member&gt; findByUsername(String username); } 
ìŠ¤í”„ë§ ë°ì´í„° JPA í…ŒìŠ¤íŠ¸ @Test public void basicTest() throws Exception { Member member = new Member(&#34;member1&#34;, 10); memberRepository.save(member); Member findMember = memberRepository.findById(member.getId()).get(); assertThat(findMember).isEqualTo(member); List&lt;Member&gt; result1 = memberRepository.findAll(); assertThat(result1).containsExactly(member); List&lt;Member&gt; result2 = memberRepository.findByUsername(&#34;member1&#34;); assertThat(result2).containsExactly(member); }  QueryDSL ì „ìš© ê¸°ëŠ¥ì¸ íšŒì› searchë¥¼ ìž‘ì„±í•  ìˆ˜ì—†ë‹¤. â†’ ì‚¬ìš©ìž ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ í•„ìš”  ì‚¬ìš©ìž ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ ì‚¬ìš©ìž ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ ì‚¬ìš©ë²•
 ì‚¬ìš©ìž ì •ì˜ ì¸í„°íŽ˜ì´ìŠ¤ ìž‘ì„± ì‚¬ìš©ìž ì •ì˜ ì¸í„°íŽ˜ì´ìŠ¤ êµ¬í˜„ ìŠ¤í”„ë§ ë°ì´í„° ë¦¬í¬ì§€í† ë¦¬ì— ì‚¬ìš©ìž ì •ì˜ ì¸í„°íŽ˜ì´ìŠ¤ ìƒì†  ì‚¬ìš©ìž ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ êµ¬ì„± 1. ì‚¬ìš©ìž ì •ì˜ ì¸í„°íŽ˜ì´ìŠ¤ ìž‘ì„± public interface MemberRepositoryCustom { List&lt;Member&gt; findMemberCustom(); } 
2. ì‚¬ìš©ìž ì •ì˜ ì¸í„°íŽ˜ì´ìŠ¤ êµ¬í˜„ public class MemberRepositoryImpl implements MemberRepositoryCustom{ @Override public List&lt;Member&gt; findMemberCustom() { return null; } private final JPAQueryFactory queryFactory; public MemberRepositoryImpl(JPAQueryFactory queryFactory) { this.queryFactory = queryFactory; } @Override public List&lt;MemberTeamDto&gt; search(MemberSearchCondition condition) { return queryFactory .select(new QMemberTeamDto( member.id.as(&#34;memberId&#34;), member.username, member.age, team.id.as(&#34;teamId&#34;), team.name.as(&#34;teamName&#34;) )) .from(member) .leftJoin(member.team, team) .where( usernameEq(condition.getUsername()), teamNameEq(condition.getTeamName()), ageGoe(condition.getAgeGoe()), ageLoe(condition.getAgeLoe()) ) .fetch(); } private BooleanExpression usernameEq(String username) { return isEmpty(username)?null:member.username.eq(username); } private BooleanExpression teamNameEq(String teamName) { return hasText(teamName) ? team.name.eq(teamName):null; } private BooleanExpression ageGoe(Integer ageGoe) { return ageGoe!= null ? member.age.goe(ageGoe):null; } private BooleanExpression ageLoe(Integer ageLoe) { return ageLoe!= null ? member.age.loe(ageLoe):null; } } 
3. ìŠ¤í”„ë§ ë°ì´í„° ë¦¬í¬ì§€í† ë¦¬ì— ì‚¬ìš©ìž ì •ì˜ ì¸í„°íŽ˜ì´ìŠ¤ ìƒì† public interface MemberRepository extends JpaRepository&lt;Member, Long&gt;, MemberRepositoryCustom { // select m from Member m where m.username = ?;  List&lt;Member&gt; findByUsername(String username); } 
ì‚¬ìš©ìž ì •ì˜ ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ ì½”ë“œ ìž‘ì„± @Test public void searchTest() { Team teamA = new Team(&#34;teamA&#34;); Team teamB = new Team(&#34;teamB&#34;); em.persist(teamA); em.persist(teamB); Member member1 = new Member(&#34;member1&#34;, 10, teamA); Member member2 = new Member(&#34;member2&#34;, 20, teamA); Member member3 = new Member(&#34;member3&#34;, 30, teamB); Member member4 = new Member(&#34;member4&#34;, 40, teamB); em.persist(member1); em.persist(member2); em.persist(member3); em.persist(member4); MemberSearchCondition condition = new MemberSearchCondition(); condition.setAgeGoe(35); condition.setAgeLoe(40); condition.setTeamName(&#34;teamB&#34;); List&lt;MemberTeamDto&gt; result = memberRepository.search(condition); assertThat(result).extracting(&#34;username&#34;).containsExactly(&#34;member4&#34;); } 
ìŠ¤í”„ë§ ë°ì´í„° íŽ˜ì´ì§• í™œìš© 1 - Querydsl íŽ˜ì´ì§• ì—°ë™  ìŠ¤í”„ë§ ë°ì´í„°ì˜ Page, Pageableì„ í™œìš©í•´ë³´ìž. ì „ì²´ ì¹´ìš´íŠ¸ë¥¼ í•œë²ˆì— ì¡°íšŒí•˜ëŠ” ë‹¨ìˆœí•œ ë°©ë²• ë°ì´í„° ë‚´ìš©ê³¼ ì „ì²´ ì¹´ìš´íŠ¸ë¥¼ ë³„ë„ë¡œ ì¡°íšŒí•˜ëŠ” ë°©ë²•  ì‚¬ìš©ìž ì •ì˜ ì¸í„°íŽ˜ì´ìŠ¤ì— íŽ˜ì´ì§• 2ê°€ì§€ ì¶”ê°€ public interface MemberRepositoryCustom { List&lt;MemberTeamDto&gt; search(MemberSearchCondition condition); Page&lt;MemberTeamDto&gt; searchPageSimple(MemberSearchCondition condition, Pageable pageable); Page&lt;MemberTeamDto&gt; searchPageComplex(MemberSearchCondition condition, Pageable pageable); } 
ì „ì²´ ì¹´ìš´íŠ¸ë¥¼ í•œë²ˆì— ì¡°íšŒí•˜ëŠ” ë‹¨ìˆœí•œ ë°©ë²• - searchPageSimple() @Override public Page&lt;MemberTeamDto&gt; searchPageSimple(MemberSearchCondition condition, Pageable pageable) { QueryResults&lt;MemberTeamDto&gt; results = queryFactory .select(new QMemberTeamDto( member.id.as(&#34;memberId&#34;), member.username, member.age, team.id.as(&#34;teamId&#34;), team.name.as(&#34;teamName&#34;) )) .from(member) .leftJoin(member.team, team) .where( usernameEq(condition.getUsername()), teamNameEq(condition.getTeamName()), ageGoe(condition.getAgeGoe()), ageLoe(condition.getAgeLoe()) ) .offset(pageable.getOffset()) // ëª‡ë²ˆì§¸ë¶€í„° ì‹œìž‘í•  ê²ƒì¸ê°€  .limit(pageable.getPageSize()) // ëª‡ê°œë¥¼ ê°€ì ¸ì˜¬ ê²ƒì¸ê°€  .fetchResults(); List&lt;MemberTeamDto&gt; content = results.getResults(); long totalCount = results.getTotal(); return new PageImpl&lt;&gt;(content, pageable, totalCount); }  Querydslì´ ì œê³µí•˜ëŠ” fetchResults() ë¥¼ ì‚¬ìš©í•˜ë©´ ë‚´ìš©ê³¼ ì „ì²´ ì¹´ìš´íŠ¸ë¥¼ í•œë²ˆì— ì¡°íšŒí•  ìˆ˜ ìžˆë‹¤. (ì‹¤ì œ ì¿¼ë¦¬ëŠ” 2ë²ˆ í˜¸ì¶œ) fetchResult() ëŠ” ì¿¼ë¦¬ ì¹´ìš´íŠ¸ ì¿¼ë¦¬ ì‹¤í–‰ì‹œ í•„ìš”ì—†ëŠ” order by ëŠ” ì œê±°í•œë‹¤.  í…ŒìŠ¤íŠ¸ ì½”ë“œ ìž‘ì„± @Test public void searchPageSimple() throws Exception { Team teamA = new Team(&#34;teamA&#34;); Team teamB = new Team(&#34;teamB&#34;); em.persist(teamA); em.persist(teamB); Member member1 = new Member(&#34;member1&#34;, 10, teamA); Member member2 = new Member(&#34;member2&#34;, 20, teamA); Member member3 = new Member(&#34;member3&#34;, 30, teamB); Member member4 = new Member(&#34;member4&#34;, 40, teamB); em.]]></description>
</item><item>
    <title>JPAì™€ QueryDSL</title>
    <link>https://jaeyeonme.github.io/posts/jpa-and-querydsl/</link>
    <pubDate>Fri, 31 Dec 2021 15:00:00 &#43;0000</pubDate>
    <author>Author</author>
    <guid>https://jaeyeonme.github.io/posts/jpa-and-querydsl/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/images/JPA/querydsl.png" referrerpolicy="no-referrer">
            </div>ìˆœìˆ˜ JPA ë¦¬í¬ì§€í† ë¦¬ì™€ Querydsl ìˆœìˆ˜ JPA ë¦¬í¬ì§€í† ë¦¬ @Repository public class MemberJpaRepository { private final EntityManager em; private final JPAQueryFactory queryFactory; public MemberJpaRepository(EntityManager em) { this.em = em; this.queryFactory = new JPAQueryFactory(em); } public void save(Member member) { em.persist(member); } public Optional&lt;Member&gt; findById(Long id) { Member findMember = em.find(Member.class, id); return Optional.ofNullable(findMember); } public List&lt;Member&gt; findAll() { return em.createQuery(&#34;select m from Member m&#34;, Member.class) .getResultList(); } public List&lt;Member&gt; findAll_Querydsl() { return queryFactory .selectFrom(member) .fetch(); } public List&lt;Member&gt; findByUsername(String username) { return em.createQuery(&#34;select m from Member m where m.username = :username&#34;, Member.class) .setParameter(&#34;username&#34;, username) .getResultList(); } public List&lt;Member&gt; findByUsername_Querydsl(String username) { return queryFactory .selectFrom(member) .where(member.username.eq(username)) .fetch(); } } 
ìˆœìˆ˜ JPA ë¦¬í¬ì§€í† ë¦¬ í…ŒìŠ¤íŠ¸ @SpringBootTest @Transactional class MemberJpaRepositoryTest { @Autowired EntityManager em; @Autowired MemberJpaRepository memberJpaRepository; @Test public void basicTest() { Member member = new Member(&#34;member1&#34;, 10); memberJpaRepository.save(member); Member findMember = memberJpaRepository.findById(member.getId()).get(); assertThat(findMember).isEqualTo(member); List&lt;Member&gt; result1 = memberJpaRepository.findAll_Querydsl(); assertThat(result1).containsExactly(member); List&lt;Member&gt; result2 = memberJpaRepository.findByUsername_Querydsl(&#34;member1&#34;); assertThat(result2).containsExactly(member); } 
ìˆœìˆ˜ JPA ë¦¬í¬ì§€í† ë¦¬ - Querydsl ì¶”ê°€ public List&lt;Member&gt; findAll() { return em.createQuery(&#34;select m from Member m&#34;, Member.class).getResultList(); } public List&lt;Member&gt; findAll_Querydsl() { return queryFactory .selectFrom(member) .fetch(); } public List&lt;Member&gt; findByUsername(String username) { return em.createQuery(&#34;select m from Member m where m.username = :username&#34;, Member.class) .setParameter(&#34;username&#34;, username) .getResultList(); } public List&lt;Member&gt; findByUsername_Querydsl(String username) { return queryFactory .selectFrom(member) .where(member.username.eq(username)) .fetch(); } 
Querydsl í…ŒìŠ¤íŠ¸ ì¶”ê°€ @Test public void basicQuerydslTest() throws Exception{ Member member = new Member(&#34;member1&#34;, 10); memberJpaRepository.save(member); Member findMember = memberJpaRepository.findById(member.getId()).get(); assertThat(findMember).isEqualTo(member); List&lt;Member&gt; result1 = memberJpaRepository.findAll_Querydsl(); assertThat(result1).containsExactly(member); List&lt;Member&gt; result2 = memberJpaRepository.findByUsername_Querydsl(&#34;member1&#34;); assertThat(result2).containsExactly(member); } 
JPAQueryFactory ìŠ¤í”„ë§ ë¹ˆ ë“±ë¡ ë‹¤ìŒê³¼ ê°™ì´ JPAQueryFactory ë¥¼ ìŠ¤í”„ë§ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì„œ ì£¼ìž…ë°›ì•„ ì‚¬ìš©í•´ë„ ëœë‹¤.
@Bean JPAQueryFactory jpaQueryFactory(EntityManager em) { return new JPAQueryFactory(em); } 
ì°¸ê³  ë™ì‹œì„± ë¬¸ì œëŠ” ê±±ì •í•˜ì§€ ì•Šì•„ë„ ëœë‹¤. ì—¬ê¸°ì„œ ìŠ¤í”„ë§ì´ ì£¼ìž…í•´ì£¼ëŠ” ì—”í‹°í‹°ë§¤ë‹ˆì €(em)ëŠ” ì‹¤ì œ ë™ìž‘ ì‹œì ì— ì§„ì§œ ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ì°¾ì•„ì£¼ëŠ” í”„ë¡ì‹œìš© ê°€ì§œ ì—”í‹°í‹° ë§¤ë‹ˆì €ì´ë‹¤. ì´ ê°€ìž ì—”í‹°í‹° ë§¤ë‹ˆì €ëŠ” ì‹¤ì œ ì‚¬ìš© ì‹œì ì— íŠ¸ëžœìž­ì…˜ ë‹¨ìœ„ë¡œ ì‹¤ì œ ì—”í‹°í‹° ë§¤ë‹ˆì €(ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸)ë¥¼ í• ë‹¹í•´ì¤€ë‹¤.
ë™ì  ì¿¼ë¦¬ì™€ ì„±ëŠ¥ ìµœì í™” ì¡°íšŒ - Builder ì‚¬ìš© MemberTeamDto - ì¡°íšŒ ìµœì í™”ìš© DTO ì¶”ê°€ @Data public class MemberTeamDto { private Long memberId; private String username; private int age; private Long teamId; private String teamName; @QueryProjection public MemberTeamDto(Long memberId, String username, int age, Long teamId, String teamName) { this.memberId = memberId; this.username = username; this.age = age; this.teamId = teamId; this.teamName = teamName; } }  @QueryProjection ì„ ì¶”ê°€í–ˆë‹¤. QMemberTeamDto ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ./gradlew compileQuerydsl ì„ í•œë²ˆ ì‹¤í–‰í•˜ìž.  ì°¸ê³  @QueryProjection ì„ ì‚¬ìš©í•˜ë©´ í•´ë‹¹ DTOê°€ Querydslì„ ì˜ì¡´í•˜ê²Œ ëœë‹¤. ì´ëŸ° ì˜ì¡´ì´ ì‹«ìœ¼ë©´, í•´ë‹¹ ì• ë…¸í…Œì´ì…˜ì„ ì œê±°í•˜ê³ , Proejction.bean(), fields(), constructor() ì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤.
íšŒì› ê²€ìƒ‰ ì¡°ê±´ (MemberSearchCondition) package study.querydsl.dto; import lombok.Data; @Data public class MemberSearchCondition { // íšŒì›ëª…, íŒ€ëª…, ë‚˜ì´(ageGoe, ageLoe)  private String username; private String teamName; private Integer ageGoe; private Integer ageLoe; }  ì´ë¦„ì´ ë„ˆë¬´ ê¸¸ë©´ MemberCond ë“±ìœ¼ë¡œ ì¤„ì—¬ ì‚¬ìš©í•´ë„ ëœë‹¤.  Builderë¥¼ ì‚¬ìš©í•œ ì˜ˆì œ - searchByBuilder ë©”ì„œë“œ ìž‘ì„± public List&lt;MemberTeamDto&gt; searchByBuilder(MemberSearchCondition condition) { BooleanBuilder builder = new BooleanBuilder(); if (hasText(condition.getUsername())) { builder.and(member.username.eq(condition.getUsername())); } if (hasText(condition.getTeamName())) { builder.and(team.name.eq(condition.getTeamName())); } if (condition.getAgeGoe() != null) { builder.and(member.age.goe(condition.getAgeGoe())); } if (condition.getAgeLoe() != null) { builder.and(member.age.loe(condition.getAgeLoe())); } return queryFactory .select(new QMemberTeamDto( member.id.as(&#34;memberId&#34;), member.username, member.age, team.id.as(&#34;teamId&#34;), team.name.as(&#34;teamName&#34;) )) .from(member) .leftJoin(member.team, team) .where(builder) .fetch(); }]]></description>
</item><item>
    <title>QueryDSL ì¤‘ê¸‰ ë¬¸ë²•</title>
    <link>https://jaeyeonme.github.io/posts/querydsl-intermediate-grammer/</link>
    <pubDate>Fri, 31 Dec 2021 13:00:00 &#43;0000</pubDate>
    <author>Author</author>
    <guid>https://jaeyeonme.github.io/posts/querydsl-intermediate-grammer/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/images/JPA/querydsl.png" referrerpolicy="no-referrer">
            </div>í”„ë¡œì ì…˜ê³¼ ê²°ê³¼ ë°˜í™˜ - ê¸°ë³¸ í”„ë¡œì ì…˜ : select ëŒ€ìƒ ì§€ì •
í”„ë¡œì ì…˜ ëŒ€ìƒì´ í•˜ë‚˜
List&lt;String&gt; result = queryFactory .select(member.username) .from(member) .fetch();  í”„ë¡œì ì…˜ ëŒ€ìƒì´ í•˜ë‚˜ë©´ íƒ€ìž…ì„ ëª…í™•í•˜ê²Œ ì§€ì •í•  ìˆ˜ ìžˆìŒ(List&lt;String&gt;) í”„ë¡œì ì…˜ ëŒ€ìƒì´ ë‘˜ ì´ìƒì´ë©´ íŠœí”Œì´ë‚˜ DTOë¡œ ì¡°íšŒ  íŠœí”Œ ì¡°íšŒ í”„ë¡œì ì…˜ ëŒ€ìƒì´ ë‘˜ ì´ìƒì¼ ë•Œ ì‚¬ìš©
com.querydsl.core.Tuple
List&lt;Tuple&gt; result = queryFactory .select(member.username, member.age) .from(member) .fetch(); for (Tuple tuple : result) { String username = tuple.get(member.username); Integer age = tuple.get(member.age); System.out.println(&#34;username = &#34; + username); System.out.println(&#34;age = &#34; + age); }  Tuple ì€ ë¦¬í¬ì§€í† ë¦¬ ê³„ì¸µì•ˆì—ì„œ ì“°ëŠ” ì •ë„ëŠ” ê´œì°®ì§€ë§Œ ê·¸ ë°–ì˜ ê³„ì¸µì—ì„œëŠ” DTOë¡œ ë³€í™˜í•´ì„œ ì“°ëŠ” ê²ƒì´ ì¢‹ë‹¤. â†’ Tuple ë„ ê²°êµ­ Querydslì— ì¢…ì†ì ì´ê¸° ë–„ë¬¸  í”„ë¡œì ì…˜ê³¼ ê²°ê³¼ ë°˜í™˜ - DTO ì¡°íšŒ ìˆœìˆ˜ JPAì—ì„œ DTO ì¡°íšŒ ìœ„ì—ì„œ select ì ˆì—ì„œ ëŒ€ìƒì„ ì§€ì •(í”„ë¡œì ì…˜)í•´ì„œ ê°€ì ¸ì˜¤ê³  ì‹¶ì„ë•Œ ê·¸ ëŒ€ìƒì´ ë‘˜ ì´ìƒì´ë©´ Tupleë¡œ ê°€ì ¸ì™”ì—ˆë‹¤. í•˜ì§€ë§Œ, ê·¸ ì™¸ ê³„ì¸µìœ¼ë¡œ ê°€ì ¸ê°ˆ ë•ŒëŠ” DTOë¡œ ê°€ì ¸ê°€ëŠ”ê²Œ ì¢‹ë‹¤. ìš°ì„  ìˆœìˆ˜ JPAë¥¼ ì´ìš©í•´ì„œ DTOë¡œ ì¡°íšŒí•˜ëŠ” ì½”ë“œë¥¼ ìž‘ì„±í•´ë³´ìž.
MemberDto
@Data @NoArgsConstructor public class MemberDto { private String username; private int age; public MemberDto(String username, int age) { this.username = username; this.age = age; } } 
ìˆœìˆ˜ JPAì—ì„œ DTO ì¡°íšŒ ì½”ë“œ
@Test public void findDtoByJPQL() { List&lt;MemberDto&gt; result = em.createQuery(&#34;select new study.querydsl.dto.MemberDto(m.username, m.age) from Member m&#34;, MemberDto.class) .getResultList(); for (MemberDto memberDto : result) { System.out.println(&#34;memberDto = &#34; + memberDto); } }  ìˆœìˆ˜ JPAì—ì„œ DTOë¥¼ ì¡°íšŒí•  ë•ŒëŠ” new ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ì•¼ í•¨ DTOì˜ packageì´ë¦„ì„ ë‹¤ ì ì–´ì¤˜ì•¼í•´ì„œ ì§€ì €ë¶„í•¨ ìƒì„±ìž ë°©ì‹ë§Œ ì§€ì›í•¨  QueryDSL ë¹ˆ ìƒì„± (Bean Population) ê²°ê³¼ë¥¼ DTOë°˜í™˜í•  ë–„ ì‚¬ìš©í•˜ë©° 3ê°€ì§€ ë°©ë²•ì´ ì¡´ìž¬í•œë‹¤.
 í”„ë¡œí¼í‹° ì ‘ê·¼ í•„ë“œ ì§ì ‘ ì ‘ê·¼ ìƒì„±ìž ì‚¬ìš©  í”„ë¡œí¼í‹° ì ‘ê·¼ - Setter
@Test public void findDtoBySetter() { List&lt;MemberDto&gt; result = queryFactory .select(Projections.bean(MemberDto.class, member.username, member.age)) .from(member) .fetch(); for (MemberDto memberDto : result) { System.out.println(&#34;memberDto = &#34; + memberDto); } }  Projections.bean(ì£¼ìž…ëŒ€ìƒí´ëž˜ìŠ¤, í”„ë¡œí¼í‹°1, í”„ë¡œí¼í‹°2&hellip;)ë°©ì‹ìœ¼ë¡œ í”„ë¡œí¼í‹°ì— ê°’ì„ ì£¼ìž…  í•„ë“œ ì§ì ‘ ì ‘ê·¼
@Test public void findDtoByField() { List&lt;MemberDto&gt; result = queryFactory .select(Projections.fields(MemberDto.class, member.username, member.age)) .from(member) .fetch(); for (MemberDto memberDto : result) { System.out.println(&#34;memberDto = &#34; + memberDto); } }  Getter, Setterê°€ ì—†ì–´ë„ í•„ë“œì— ë°”ë¡œ ê°’ì„ ì£¼ìž… Projections.fields(ì£¼ìž…ëŒ€ìƒí´ëž˜ìŠ¤, í•„ë“œ1, í•„ë“œ2&hellip;)  í•„ë“œ ì§ì ‘ ì ‘ê·¼ - ë³„ì¹­ì´ ë‹¤ë¥¼ ë•Œ
@Test public void findUserDtoByField() throws Exception { QMember memberSub = new QMember(&#34;memberSub&#34;); List&lt;UserDto&gt; result = queryFactory .select(Projections.fields(UserDto.class, member.username.as(&#34;name&#34;), ExpressionUtils.as(JPAExpressions .select(memberSub.age.max()) .from(memberSub), &#34;age&#34;) )) .from(member) .fetch(); for (UserDto memberDto : result) { System.out.println(&#34;memberDto = &#34; + memberDto); } }  í•„ë“œë‚˜ í”„ë¡œí¼í‹°ëª… ì ‘ê·¼ ìƒì„±ë°©ì‹ì—ì„œ ì´ë¦„ì´ ë‹¤ë¥¼ ë•Œ í•´ê²°ë°©ì•ˆì„ as(name)ì„ ì´ìš©í•´ì„œ í•´ê²°í•œë‹¤. ExpressionUtils.as(source,alias) : í•„ë“œë‚˜ ì„œë¸Œ ì¿¼ë¦¬ì— ë³„ì¹­ ì ìš© username.as(&quot;memberName&quot;) : í•„ë“œì— ë³„ì¹­ ì ìš©  ìƒì„±ìž ì ìš©
@Test public void findDtoByConstructor() { List&lt;MemberDto&gt; result = queryFactory .select(Projections.constructor(MemberDto.class, member.username, member.age)) .from(member) .fetch(); for (MemberDto memberDto : result) { System.out.println(&#34;memberDto = &#34; + memberDto); } } 
í”„ë¡œì ì…˜ê³¼ ê²°ê³¼ ë°˜í™˜ - @QueryProjection í”„ë¡œì ì…˜ê²°ê³¼ë¥¼ ë°˜í™˜í•  DTOì— @QueryProjection ì„ ìƒì„±ìžì— ë¶™í˜€ì¤€ ë’¤ gradle â†’ tasks â†’ other â†’ compileQuerydsl ì„ í†µí•´ DTOë„ Qíƒ€ìž…ìœ¼ë¡œ ìƒì„±í•´ ì¤€ë‹¤.
ìƒì„±ìž + @QueryProjection @Data @NoArgsConstructor public class MemberDto { private String username; private int age; @QueryProjection public MemberDto(String username, int age) { this.username = username; this.age = age; } }  ./gradlew compileQuerydsl QMemberDto ìƒì„± í™•ì¸  @QueryProjection í™œìš© @Test public void findDtoByQueryProjection() throws Exception{ List&lt;MemberDto&gt; result = queryFactory .]]></description>
</item><item>
    <title>QueryDSL ê¸°ë³¸ ë¬¸ë²•</title>
    <link>https://jaeyeonme.github.io/posts/querydsl-basic-grammer/</link>
    <pubDate>Fri, 31 Dec 2021 12:00:00 &#43;0000</pubDate>
    <author>Author</author>
    <guid>https://jaeyeonme.github.io/posts/querydsl-basic-grammer/</guid>
    <description><![CDATA[<div class="featured-image">
                <img src="/images/JPA/querydsl.png" referrerpolicy="no-referrer">
            </div>JPQL VS QueryDSL QueryDSL vs JPQL @Test public void startJQPL() { // member1ì„ ì°¾ì•„ë¼  String qlString = &#34;select m from Member m &#34; + &#34;where m.username = :username&#34;; Member findMember = em.createQuery(qlString, Member.class) .setParameter(&#34;username&#34;, &#34;member1&#34;) .getSingleResult(); assertThat(findMember.getUsername()).isEqualTo(&#34;member1&#34;); } @Test public void startQuerydsl() { // member1ì„ ì°¾ì•„ë¼.  JPAQueryFactory queryFactory = new JPAQueryFactory(em); QMember m = new QMember(&#34;m&#34;); Member findMember = queryFactory .select(m) .from(m) .where(m.username.eq(&#34;member1&#34;)) // íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì²˜ë¦¬  .fetchOne(); assertThat(findMember.getUsername()).isEqualTo(&#34;member1&#34;); }  EntityManager ë¡œ JPAQueryFactory ìƒì„± Querydslì€ JPQL ë¹Œë” JPQL : ë¬¸ìž(ì‹¤í–‰ ì‹œì  ì˜¤ë¥˜), Querydsl : ì½”ë“œ(ì»´íŒŒì¼ ì‹œì  ì˜¤ë¥˜) JPQL : íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì§ì ‘, Querydsl : íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ìžë™ ì²˜ë¦¬  JPAQueryFactoryë¥¼ í•„ë“œë¡œ @SpringBootTest @Transactional public class QuerydslBasicTest { @Autowired EntityManager em; JPAQueryFactory queryFactory; @BeforeEach public void before() { queryFactory = new JPAQueryFactory(em); // ... 	} @Test public void startQuerydsl() { // member1ì„ ì°¾ì•„ë¼.  QMember m = new QMember(&#34;m&#34;); Member findMember = queryFactory .select(m) .from(m) .where(m.username.eq(&#34;member1&#34;)) // íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì²˜ë¦¬  .fetchOne(); assertThat(findMember.getUsername()).isEqualTo(&#34;member1&#34;); } }  JPAQueryFactoryë¥¼ í•„ë“œë¡œ ì œê³µí•˜ë©´ ë™ì‹œì„± ë¬¸ì œëŠ” ì–´ë–»ê²Œ ë ê¹Œ? ë™ì‹œì„± ë¬¸ì œëŠ” JPAQueryFactoryë¥¼ ìƒì„±í•  ë•Œ ì œê³µí•˜ëŠ” EntityManager(em)ì— ë‹¬ë ¤ìžˆë‹¤. ìŠ¤í”„ë§ í”„ë ˆìž„ì›Œí¬ëŠ” ì—¬ëŸ¬ ì“°ë ˆë“œì—ì„œ ë™ì‹œì— ê°™ì€ EntityManagerì— ì ‘ê·¼í•´ë„, íŠ¸ëžœìž­ì…˜ ë§ˆë‹¤ ë³„ë„ì˜ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ë¥¼ ì œê³µí•˜ê¸° ë•Œë¬¸ì—, ë™ì‹œì„± ë¬¸ì œëŠ” ê±±ì •í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.  ê¸°ë³¸ Q-Type í™œìš© Qí´ëž˜ìŠ¤ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ëŠ” 2ê°€ì§€ ë°©ë²• QMember qMember = new QMember(&#34;m&#34;); //ë³„ì¹­ ì§ì ‘ ì§€ì • QMember qMember = QMember.member; //ê¸°ë³¸ ì¸ìŠ¤í„´ìŠ¤ ì‚¬ìš© 
ê¸°ë³¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ static importì™€ í•¨ê»˜ ì‚¬ìš© @Test public void startQuerydsl() { Member findMember = queryFactory .select(QMember.member) .from(QMember.member) .where(QMember.member.username.eq(&#34;member1&#34;)) // íŒŒë¼ë¯¸í„° ë°”ì¸ë”© ì²˜ë¦¬  .fetchOne(); assertThat(findMember.getUsername()).isEqualTo(&#34;member1&#34;); } 
ë‹¤ìŒ ì„¤ì •ì„ ì¶”ê°€í•˜ë©´ ì‹¤í–‰ë˜ëŠ” JPQLì„ ë³¼ ìˆ˜ ìžˆë‹¤.
spring.jpa.properties.hibernate.use_sql_comments: true 
ì°¸ê³ : ê°™ì€ í…Œì´ë¸”ì„ ì¡°ì¸í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ì•„ë‹ˆë©´ ê¸°ë³¸ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ìž
ê²€ìƒ‰ ì¡°ê±´ ì¿¼ë¦¬ ê¸°ë³¸ ê²€ìƒ‰ ì¿¼ë¦¬ @Test public void search() { Member findMember = queryFactory .selectFrom(member) .where(member.username.eq(&#34;member1&#34;) .and(member.age.eq(10))) .fetchOne(); assertThat(findMember.getUsername()).isEqualTo(&#34;member1&#34;); }  ê²€ìƒ‰ ì¡°ê±´ì€ .and() , .or() ë¥¼ ë©”ì„œë“œ ì²´ì¸ìœ¼ë¡œ ì—°ê²°í•  ìˆ˜ ìžˆë‹¤. select ì™€ from ì€ selectFrom ìœ¼ë¡œ í•©ì¹  ìˆ˜ ìžˆë‹¤.  JPQLì´ ì œê³µí•˜ëŠ” ëª¨ë“  ê²€ìƒ‰ ì¡°ê±´ ì œê³µ member.username.eq(&#34;member1&#34;) // username = &#39;member1&#39; member.username.ne(&#34;member1&#34;) //username != &#39;member1&#39; member.username.eq(&#34;member1&#34;).not() // username != &#39;member1&#39;  member.username.isNotNull() //ì´ë¦„ì´ is not null  member.age.in(10, 20) // age in (10,20) member.age.notIn(10, 20) // age not in (10, 20) member.age.between(10,30) // between 10, 30  member.age.goe(30) // age &gt;= 30 member.age.gt(30) // age &gt; 30 member.age.loe(30) // age &lt;= 30 member.age.lt(30) // age &lt; 30  member.username.like(&#34;member%&#34;) // like ê²€ìƒ‰ member.username.contains(&#34;member&#34;) // like â€˜%member%â€™ ê²€ìƒ‰ member.username.startsWith(&#34;member&#34;) // like â€˜member%â€™ ê²€ìƒ‰ 
AND ì¡°ê±´ì„ íŒŒë¼ë¯¸í„°ë¡œ ì²˜ë¦¬ @Test public void searchAndParam() { Member findMember = queryFactory .selectFrom(member) .where( member.username.eq(&#34;member1&#34;), member.age.eq(10)) .fetchOne(); assertThat(findMember.getUsername()).isEqualTo(&#34;member1&#34;); }  where() ì— íŒŒë¼ë¯¸í„°ë¡œ ì¡°ê±´ê²€ìƒ‰ì„ ì¶”ê°€í•˜ë©´ AND ì¡°ê±´ì´ ì¶”ê°€ë¨ ì´ ê²½ìš° null ê°’ì€ ë¬´ì‹œ â†’ ë©”ì„œë“œ ì¶”ì¶œì„ í™œìš©í•´ì„œ ë™ì  ì¿¼ë¦¬ë¥¼ ê¹”ë”í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìžˆìŒ â†’ ë’¤ì—ì„œ ì„¤ëª…  ê²°ê³¼ ì¡°íšŒ  fetch() : ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ, ë°ì´í„° ì—†ìœ¼ë©´ ë¹ˆ ë¦¬ìŠ¤íŠ¸ ë°˜í™˜ fetchOne() : ë‹¨ ê±´ ì¡°íšŒ  ê²°ê³¼ê°€ ì—†ìœ¼ë©´ : null ê²°ê³¼ê°€ ë‘˜ ì´ìƒì´ë©´ : com.querydsl.core.NonUniqueResultException   fetchFirst() : limit(1).fetchOne() fetchResults() : íŽ˜ì´ì§• ì •ë³´ í¬í•¨, total count ì¿¼ë¦¬ ì¶”ê°€ ì‹¤í–‰ fetchCount() : count ì¿¼ë¦¬ë¡œ ë³€ê²½í•´ì„œ count ìˆ˜ ì¡°íšŒ  // List List&lt;Member&gt; fetch = queryFactory .selectFrom(member) .]]></description>
</item></channel>
</rss>
