<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
        <title>í”„ë¡ì‹œì™€ ì—°ê´€ê´€ê³„ ê´€ë¦¬ - ğŸ“š | Dev Blog</title><meta name="Description" content=""><meta property="og:title" content="í”„ë¡ì‹œì™€ ì—°ê´€ê´€ê³„ ê´€ë¦¬" />
<meta property="og:description" content="1. í”„ë¡ì‹œ   í”„ë¡ì‹œë€?
 í…Œì´ë¸”ì„ ì¡°íšŒí•´ì„œ ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì—°ê´€ê´€ê³„ ê°ì²´ëŠ” ì•ˆê°€ì ¸ ì˜¤ê³  ì‹¶ìœ¼ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?
  em.find() : ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í†µí•´ì„œ ì‹¤ì œ ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ
  em.getReference(): ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒë¥¼ ë¯¸ë£¨ëŠ” ê°€ì§œ(í”„ë¡ì‹œ) ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ
Member member = em.getReference(Member.class, 1L); System.out.println(&#34;member = &#34; &#43; member.getClass()); // HibernateProxy ê°ì²´ getReference() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì§„ì§œ ê°ì²´ê°€ ì•„ë‹Œ í•˜ì´ë²„ë„¤ì´íŠ¸ ë‚´ë¶€ ë¡œì§ìœ¼ë¡œ í”„ë¡ì‹œ ì—”í‹°í‹° ê°ì²´ ë°˜í™˜
ë‚´ë¶€ êµ¬ì¡°ëŠ” í‹€ì€ ê°™ì§€ë§Œ ë‚´ìš©ì´ ë¹„ì–´ìˆë‹¤.
í”„ë¡ì‹œ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.&#34; í”„ë¡ì‹œ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.    íŠ¹ì§•
  ì‹¤ì œ í´ë˜ìŠ¤ë¥¼ìƒì†ë°›ì•„ì„œ ë§Œë“¤ì–´ì§
  ì‹¤ì œ í´ë˜ìŠ¤ì™€ ê²‰ ëª¨ì–‘ì´ ê°™ë‹¤.
  ì‚¬ìš©í•˜ëŠ” ì…ì¥ì—ì„œëŠ” ì§„ì§œ ê°ì²´ì¸ì§€ êµ¬ë¶„ í•„ìš”ê°€ ì—†ë‹¤. (ì´ë¡ ì ìœ¼ë¡œ)
  í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ì˜ ì°¸ì¡°(target)ë¥¼ ë³´ê´€í•œë‹¤.
  í”„ë¡ì‹œ ê°ì²´ë¥¼ í˜¸ì¶œ(getName())í•˜ë©´ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ì˜ ë©”ì†Œë“œ í˜¸ì¶œ
  í”„ë¡ì‹œëŠ” ì²˜ìŒ ì‚¬ìš©í•  ë•Œ í•œ ë²ˆë§Œ ì´ˆê¸°í™”
  í”„ë¡ì‹œ ê°ì²´ë¥¼ ì´ˆê¸°í™” í•  ë•Œ í”„ë¡ì‹œ ê°ì²´ê°€ ì‹¤ì œ ì—”í‹°í‹°ë¡œ ë°”ë€ŒëŠ” ê²ƒì€ ì•„ë‹˜, ì´ˆê¸°í™”ë˜ë©´ í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ ì‹¤ì œ ì—”í‹°í‹°ì— ì ‘ê·¼ ê°€ëŠ¥
  í”„ë¡ì‹œ ê°ì²´ëŠ” ì›ë³¸ ì—”í‹°í‹°ë¥¼ ìƒì†ë°›ìŒ, ë”°ë¼ì„œ íƒ€ì… ì²´í¬ì‹œ ì£¼ì˜í•´ì•¼í•¨( == ë¹„êµ ì‹¤íŒ¨, ëŒ€ì‹  instance of ì‚¬ìš©)
m1.getClass() == m2.getClass() //false m1 instanceof Member m2 instanceof Member     ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì°¾ëŠ” ì—”í‹°í‹°ê°€ ì´ë¯¸ ìˆìœ¼ë©´ em.getReference()ë¥¼ í˜¸ì¶œí•´ë„ ì‹¤ì œ ì—”í‹°í‹° ë°˜í™˜
Member m1 = em.find(Member.class, member1.getId()); System.out.println(&#34;m1 = &#34;&#43; m1.getClass());//Member  Member reference = em.getReference(Member.class, member1.getId()); System.out.println(&#34;reference = &#34; reference.getClass()); //Member  m1 == reference //true ì´ë¯¸ Memberë¥¼ 1ì°¨ ìºì‹œì—ë„ ì˜¬ë¼ì™€ ìˆëŠ”ë°, í”„ë¡ì‹œë¥¼ ë°˜í™˜í•  í•„ìš”ê°€ ì—†ë‹¤.
    ë°˜ëŒ€ë¡œ getReference()ë¡œ í”„ë¡ì‹œê°ì²´ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©´ ì‹¤ì œë¡œ find()ë¥¼ í–ˆì„ë•Œë„ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë°˜í™˜í•¨
  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ì—†ëŠ” ì¤€ì˜ì† ìƒíƒœì¼ ë•Œ, í”„ë¡ì‹œë¥¼ ì´ˆê¸°í™”í•˜ë©´ ë¬¸ì œ ë°œìƒ
Member refMember = em.getReference(Member.class, member.getId()); System.out.println(&#34;refMember = &#34;&#43; refMember.getClass());//Proxy  em.detach(refMember); //em.clear  refMember.getUsername(); //org.hibernate.LazyInitializationException   í”„ë¡ì‹œ ê°ì²´ì˜ ì´ˆê¸°í™”
Member member = em.getRefernce(Member.class, &#34;id1&#34;);//(1) member.getName();//(2) ì½”ë“œ 1ë¼ì¸ì—ì„œ getReference()ë¥¼ í˜¸ì¶œí•˜ë©´ í”„ë¡ì‹œê°ì²´ë¥¼ ê°€ì ¸ì˜¨ ë‹¤ìŒ, getName()ì„ í˜¸ì¶œí•˜ë©´
JPAê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì´ˆê¸°í™” ìš”ì²­ì„ í•œë‹¤.
ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œëŠ” ì‹¤ì œ DBë¥¼ ì¡°íšŒí•´ì„œ ê°€ì ¸ì˜¨ ë‹¤ìŒ ì‹¤ì œ Entityì— ê°’ì„ ë„£ì–´ ìƒì„±í•œ ë‹¤ìŒ í”„ë¡ì‹œ ê°ì²´ëŠ”
ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ì—°ê²°í•´ì„œ ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•œë‹¤.
ê·¸ ì´í›„ì—ëŠ” ì´ë¯¸ ì´ˆê¸°í™”ë˜ì–´ìˆëŠ” í”„ë¡ì‹œê°ì²´ ì—¬ê¸°ì— í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•œë‹¤.
í”„ë¡ì‹œ í™•ì¸
 í”„ë¡ì‹œ ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ˆê¸°í™” ì—¬ë¶€ í™•ì¸ : PersistenceUnitUtil.isLoaded(Object entity) â†’ entityManagerFactory.getPersistenceUnitUtil().isLoaded(object) í”„ë¡ì‹œ í´ë˜ìŠ¤ í™•ì¸ ë°©ë²• : entity.getClass().getname() ì¶œë ¥(..javasist.. or HibernateProxy&hellip;) í”„ë¡ì‹œ ê°•ì œ ì´ˆê¸°í™” : org.hibernate.Hibernate.initialize(entity); ì°¸ê³ : JPA í‘œì¤€ì€ ê°•ì œ ì´ˆê¸°í™” ì—†ìŒ ê°•ì œí˜¸ì¶œ : method.getName();  2. ì¦‰ì‹œë¡œë”©ê³¼ ì§€ì—°ë¡œë”©  ì§€ì—° ë¡œë”© Memberë¥¼ ì¡°íšŒí•  ë•Œ Team(ì—°ê´€ê´€ê³„)ë„ í•¨ê»˜ ì¡°íšŒí•´ì•¼ í• ê¹Œ? : ë‹¨ìˆœíˆ member ì •ë³´ë§Œì‚¬ìš©í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
ì§€ì—° ë¡œë”© LAZYì„ ì‚¬ìš©í•´ì„œ í”„ë¡ì‹œë¡œ ì¡°íšŒ
fetch = FetchType.LAZY
/*Member*/ @Entity public class Member { ... @ManyToOne(fetch = FetchType.LAZY) //ì§€ì—°ë¡œë”© ì‚¬ìš©  @JoinColumn(name=&#34;TEAM_ID&#34;) private Team team; ... } ... Member m = em.find(Member.class, member1.getId()); // Member ê°ì²´ ë°˜í™˜ System.out.println(&#34;m = &#34;&#43; m.getTeam().getClass()); // Team$HibernateProxyê°ì²´ ë°˜í™˜ m.getTeam().getName() // teamì„ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ì‹œì ì—ì„œ dbì¡°íšŒ ì—”í‹°í‹° ë°˜í™˜ ... ì—°ê´€ê´€ê³„ì— ìˆëŠ” ë‹¤ë¥¸ ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¹ˆë„ìˆ˜ê°€ ë‚®ì„ ê²½ìš° ì§€ì—°ë¡œë”©ì„ ì‚¬ìš©í•´ ë¶ˆí•„ìš”í•œ ì—”í‹°í‹° ì¡°íšŒë¥¼ ë§‰ì„ ìˆ˜ ìˆë‹¤.
ì¦‰ì‹œ ë¡œë”© â“Memberì™€ Teamì„ ê°™ì´ ì“°ëŠ” ë¹ˆë„ê°€ ë†’ì„ ê²½ìš°ì—ëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?
ì¦‰ì‹œ ë¡œë”© EAGERë¥¼ ì‚¬ìš©í•´ì„œ í•¨ê¼ ì¡°íšŒ fetch = FetchType.EAGER
/*Member*/ @Entity public class Member{ ... @ManyToOne(fetch = FetchType.EAGER) //ì¦‰ì‹œë¡œë”© ì‚¬ìš©  @JoinColumn(name=&#34;TEAM_ID&#34;) private Team team; ... } ... Member m = em." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jaeyeonme.github.io/posts/jpa-proxy-and-management/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-29T13:40:00+00:00" />
<meta property="article:modified_time" content="2021-12-29T13:40:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="í”„ë¡ì‹œì™€ ì—°ê´€ê´€ê³„ ê´€ë¦¬"/>
<meta name="twitter:description" content="1. í”„ë¡ì‹œ   í”„ë¡ì‹œë€?
 í…Œì´ë¸”ì„ ì¡°íšŒí•´ì„œ ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì—°ê´€ê´€ê³„ ê°ì²´ëŠ” ì•ˆê°€ì ¸ ì˜¤ê³  ì‹¶ìœ¼ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?
  em.find() : ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í†µí•´ì„œ ì‹¤ì œ ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ
  em.getReference(): ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒë¥¼ ë¯¸ë£¨ëŠ” ê°€ì§œ(í”„ë¡ì‹œ) ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ
Member member = em.getReference(Member.class, 1L); System.out.println(&#34;member = &#34; &#43; member.getClass()); // HibernateProxy ê°ì²´ getReference() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì§„ì§œ ê°ì²´ê°€ ì•„ë‹Œ í•˜ì´ë²„ë„¤ì´íŠ¸ ë‚´ë¶€ ë¡œì§ìœ¼ë¡œ í”„ë¡ì‹œ ì—”í‹°í‹° ê°ì²´ ë°˜í™˜
ë‚´ë¶€ êµ¬ì¡°ëŠ” í‹€ì€ ê°™ì§€ë§Œ ë‚´ìš©ì´ ë¹„ì–´ìˆë‹¤.
í”„ë¡ì‹œ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.&#34; í”„ë¡ì‹œ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.    íŠ¹ì§•
  ì‹¤ì œ í´ë˜ìŠ¤ë¥¼ìƒì†ë°›ì•„ì„œ ë§Œë“¤ì–´ì§
  ì‹¤ì œ í´ë˜ìŠ¤ì™€ ê²‰ ëª¨ì–‘ì´ ê°™ë‹¤.
  ì‚¬ìš©í•˜ëŠ” ì…ì¥ì—ì„œëŠ” ì§„ì§œ ê°ì²´ì¸ì§€ êµ¬ë¶„ í•„ìš”ê°€ ì—†ë‹¤. (ì´ë¡ ì ìœ¼ë¡œ)
  í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ì˜ ì°¸ì¡°(target)ë¥¼ ë³´ê´€í•œë‹¤.
  í”„ë¡ì‹œ ê°ì²´ë¥¼ í˜¸ì¶œ(getName())í•˜ë©´ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ì˜ ë©”ì†Œë“œ í˜¸ì¶œ
  í”„ë¡ì‹œëŠ” ì²˜ìŒ ì‚¬ìš©í•  ë•Œ í•œ ë²ˆë§Œ ì´ˆê¸°í™”
  í”„ë¡ì‹œ ê°ì²´ë¥¼ ì´ˆê¸°í™” í•  ë•Œ í”„ë¡ì‹œ ê°ì²´ê°€ ì‹¤ì œ ì—”í‹°í‹°ë¡œ ë°”ë€ŒëŠ” ê²ƒì€ ì•„ë‹˜, ì´ˆê¸°í™”ë˜ë©´ í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´ ì‹¤ì œ ì—”í‹°í‹°ì— ì ‘ê·¼ ê°€ëŠ¥
  í”„ë¡ì‹œ ê°ì²´ëŠ” ì›ë³¸ ì—”í‹°í‹°ë¥¼ ìƒì†ë°›ìŒ, ë”°ë¼ì„œ íƒ€ì… ì²´í¬ì‹œ ì£¼ì˜í•´ì•¼í•¨( == ë¹„êµ ì‹¤íŒ¨, ëŒ€ì‹  instance of ì‚¬ìš©)
m1.getClass() == m2.getClass() //false m1 instanceof Member m2 instanceof Member     ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì°¾ëŠ” ì—”í‹°í‹°ê°€ ì´ë¯¸ ìˆìœ¼ë©´ em.getReference()ë¥¼ í˜¸ì¶œí•´ë„ ì‹¤ì œ ì—”í‹°í‹° ë°˜í™˜
Member m1 = em.find(Member.class, member1.getId()); System.out.println(&#34;m1 = &#34;&#43; m1.getClass());//Member  Member reference = em.getReference(Member.class, member1.getId()); System.out.println(&#34;reference = &#34; reference.getClass()); //Member  m1 == reference //true ì´ë¯¸ Memberë¥¼ 1ì°¨ ìºì‹œì—ë„ ì˜¬ë¼ì™€ ìˆëŠ”ë°, í”„ë¡ì‹œë¥¼ ë°˜í™˜í•  í•„ìš”ê°€ ì—†ë‹¤.
    ë°˜ëŒ€ë¡œ getReference()ë¡œ í”„ë¡ì‹œê°ì²´ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©´ ì‹¤ì œë¡œ find()ë¥¼ í–ˆì„ë•Œë„ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë°˜í™˜í•¨
  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ì—†ëŠ” ì¤€ì˜ì† ìƒíƒœì¼ ë•Œ, í”„ë¡ì‹œë¥¼ ì´ˆê¸°í™”í•˜ë©´ ë¬¸ì œ ë°œìƒ
Member refMember = em.getReference(Member.class, member.getId()); System.out.println(&#34;refMember = &#34;&#43; refMember.getClass());//Proxy  em.detach(refMember); //em.clear  refMember.getUsername(); //org.hibernate.LazyInitializationException   í”„ë¡ì‹œ ê°ì²´ì˜ ì´ˆê¸°í™”
Member member = em.getRefernce(Member.class, &#34;id1&#34;);//(1) member.getName();//(2) ì½”ë“œ 1ë¼ì¸ì—ì„œ getReference()ë¥¼ í˜¸ì¶œí•˜ë©´ í”„ë¡ì‹œê°ì²´ë¥¼ ê°€ì ¸ì˜¨ ë‹¤ìŒ, getName()ì„ í˜¸ì¶œí•˜ë©´
JPAê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì´ˆê¸°í™” ìš”ì²­ì„ í•œë‹¤.
ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œëŠ” ì‹¤ì œ DBë¥¼ ì¡°íšŒí•´ì„œ ê°€ì ¸ì˜¨ ë‹¤ìŒ ì‹¤ì œ Entityì— ê°’ì„ ë„£ì–´ ìƒì„±í•œ ë‹¤ìŒ í”„ë¡ì‹œ ê°ì²´ëŠ”
ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ì—°ê²°í•´ì„œ ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•œë‹¤.
ê·¸ ì´í›„ì—ëŠ” ì´ë¯¸ ì´ˆê¸°í™”ë˜ì–´ìˆëŠ” í”„ë¡ì‹œê°ì²´ ì—¬ê¸°ì— í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•œë‹¤.
í”„ë¡ì‹œ í™•ì¸
 í”„ë¡ì‹œ ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ˆê¸°í™” ì—¬ë¶€ í™•ì¸ : PersistenceUnitUtil.isLoaded(Object entity) â†’ entityManagerFactory.getPersistenceUnitUtil().isLoaded(object) í”„ë¡ì‹œ í´ë˜ìŠ¤ í™•ì¸ ë°©ë²• : entity.getClass().getname() ì¶œë ¥(..javasist.. or HibernateProxy&hellip;) í”„ë¡ì‹œ ê°•ì œ ì´ˆê¸°í™” : org.hibernate.Hibernate.initialize(entity); ì°¸ê³ : JPA í‘œì¤€ì€ ê°•ì œ ì´ˆê¸°í™” ì—†ìŒ ê°•ì œí˜¸ì¶œ : method.getName();  2. ì¦‰ì‹œë¡œë”©ê³¼ ì§€ì—°ë¡œë”©  ì§€ì—° ë¡œë”© Memberë¥¼ ì¡°íšŒí•  ë•Œ Team(ì—°ê´€ê´€ê³„)ë„ í•¨ê»˜ ì¡°íšŒí•´ì•¼ í• ê¹Œ? : ë‹¨ìˆœíˆ member ì •ë³´ë§Œì‚¬ìš©í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
ì§€ì—° ë¡œë”© LAZYì„ ì‚¬ìš©í•´ì„œ í”„ë¡ì‹œë¡œ ì¡°íšŒ
fetch = FetchType.LAZY
/*Member*/ @Entity public class Member { ... @ManyToOne(fetch = FetchType.LAZY) //ì§€ì—°ë¡œë”© ì‚¬ìš©  @JoinColumn(name=&#34;TEAM_ID&#34;) private Team team; ... } ... Member m = em.find(Member.class, member1.getId()); // Member ê°ì²´ ë°˜í™˜ System.out.println(&#34;m = &#34;&#43; m.getTeam().getClass()); // Team$HibernateProxyê°ì²´ ë°˜í™˜ m.getTeam().getName() // teamì„ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ì‹œì ì—ì„œ dbì¡°íšŒ ì—”í‹°í‹° ë°˜í™˜ ... ì—°ê´€ê´€ê³„ì— ìˆëŠ” ë‹¤ë¥¸ ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¹ˆë„ìˆ˜ê°€ ë‚®ì„ ê²½ìš° ì§€ì—°ë¡œë”©ì„ ì‚¬ìš©í•´ ë¶ˆí•„ìš”í•œ ì—”í‹°í‹° ì¡°íšŒë¥¼ ë§‰ì„ ìˆ˜ ìˆë‹¤.
ì¦‰ì‹œ ë¡œë”© â“Memberì™€ Teamì„ ê°™ì´ ì“°ëŠ” ë¹ˆë„ê°€ ë†’ì„ ê²½ìš°ì—ëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?
ì¦‰ì‹œ ë¡œë”© EAGERë¥¼ ì‚¬ìš©í•´ì„œ í•¨ê¼ ì¡°íšŒ fetch = FetchType.EAGER
/*Member*/ @Entity public class Member{ ... @ManyToOne(fetch = FetchType.EAGER) //ì¦‰ì‹œë¡œë”© ì‚¬ìš©  @JoinColumn(name=&#34;TEAM_ID&#34;) private Team team; ... } ... Member m = em."/>
<meta name="application-name" content="ğŸ“š | Dev Blog">
<meta name="apple-mobile-web-app-title" content="ğŸ“š | Dev Blog"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://jaeyeonme.github.io/posts/jpa-proxy-and-management/" /><link rel="prev" href="https://jaeyeonme.github.io/posts/jpa-advanced-mapping/" /><link rel="next" href="https://jaeyeonme.github.io/posts/jpa-value-type/" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/style.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13.0/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.7.2/animate.min.css"><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "í”„ë¡ì‹œì™€ ì—°ê´€ê´€ê³„ ê´€ë¦¬",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/jaeyeonme.github.io\/posts\/jpa-proxy-and-management\/"
        },"genre": "posts","keywords": "JPA, Hibernate","wordcount":  1262 ,
        "url": "https:\/\/jaeyeonme.github.io\/posts\/jpa-proxy-and-management\/","datePublished": "2021-12-29T13:40:00+00:00","dateModified": "2021-12-29T13:40:00+00:00","publisher": {
            "@type": "Organization",
            "name": "Jaeyeon"},"author": {
                "@type": "Person",
                "name": "Jaeyeon"
            },"description": ""
    }
    </script></head>
    <body header-desktop="auto" header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="ğŸ“š | Dev Blog">ğŸ“š | Dev Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="ğŸ“š | Dev Blog">ğŸ“š | Dev Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">Contents</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animated flipInX">í”„ë¡ì‹œì™€ ì—°ê´€ê´€ê³„ ê´€ë¦¬</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel=" author" class="author"><i class="fas fa-user-circle fa-fw"></i>Jaeyeon</a></span>&nbsp;<span class="post-category">included in <a href="/categories/jpa/"><i class="far fa-folder fa-fw"></i>JPA</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2021-12-29">2021-12-29</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1262 words&nbsp;
                <i class="far fa-clock fa-fw"></i>&nbsp;6 minutes&nbsp;</div>
        </div><div class="featured-image"><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="/images/JPA/jpa.png"
        data-srcset="/images/JPA/jpa.png, /images/JPA/jpa.png 1.5x, /images/JPA/jpa.png 2x"
        data-sizes="auto"
        alt="/images/JPA/jpa.png"
        title="/images/JPA/jpa.png" /></div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#1-í”„ë¡ì‹œ">1. í”„ë¡ì‹œ</a></li>
    <li><a href="#2-ì¦‰ì‹œë¡œë”©ê³¼-ì§€ì—°ë¡œë”©">2. ì¦‰ì‹œë¡œë”©ê³¼ ì§€ì—°ë¡œë”©</a>
      <ul>
        <li><a href="#ì§€ì—°-ë¡œë”©">ì§€ì—° ë¡œë”©</a></li>
        <li><a href="#ì¦‰ì‹œ-ë¡œë”©">ì¦‰ì‹œ ë¡œë”©</a></li>
        <li><a href="#í”„ë¡ì‹œì™€-ì¦‰ì‹œë¡œë”©-ì£¼ì˜">í”„ë¡ì‹œì™€ ì¦‰ì‹œë¡œë”© ì£¼ì˜</a></li>
        <li><a href="#n1ì˜-í•´ê²°ì±…">N+1ì˜ í•´ê²°ì±…</a></li>
        <li><a href="#ì§€ì—°-ë¡œë”©-í™œìš©">ì§€ì—° ë¡œë”© í™œìš©</a></li>
        <li><a href="#ì§€ì—°-ë¡œë”©-í™œìš©---ì‹¤ë¬´">ì§€ì—° ë¡œë”© í™œìš© - ì‹¤ë¬´</a></li>
      </ul>
    </li>
    <li><a href="#3-ì˜ì†ì„±-ì „ì´-cascadì™€-ê³ ì•„-ê°ì²´">3. ì˜ì†ì„± ì „ì´ (CASCAD)ì™€ ê³ ì•„ ê°ì²´</a>
      <ul>
        <li><a href="#ì˜ì†ì„±-ì „ì´cascadeëŠ”-ì–¸ì œ-ì¨ì•¼-í• ê¹Œ">ì˜ì†ì„± ì „ì´(CASCADE)ëŠ” ì–¸ì œ ì¨ì•¼ í• ê¹Œ?</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="1-í”„ë¡ì‹œ">1. í”„ë¡ì‹œ</h2>
<hr>
<blockquote>
<p>í”„ë¡ì‹œë€?</p>
</blockquote>
<p>í…Œì´ë¸”ì„ ì¡°íšŒí•´ì„œ ê°ì²´ë¥¼ ê°€ì ¸ì˜¬ ë•Œ ì—°ê´€ê´€ê³„ ê°ì²´ëŠ” ì•ˆê°€ì ¸ ì˜¤ê³  ì‹¶ìœ¼ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?</p>
<br>
<ul>
<li>
<p>em.find() : ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í†µí•´ì„œ ì‹¤ì œ ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ</p>
</li>
<li>
<p>em.getReference(): ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒë¥¼ ë¯¸ë£¨ëŠ” ê°€ì§œ(í”„ë¡ì‹œ) ì—”í‹°í‹° ê°ì²´ ì¡°íšŒ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">1L</span><span class="o">);</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;member = &#34;</span> <span class="o">+</span> <span class="n">member</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span> <span class="c1">// HibernateProxy ê°ì²´
</span></code></pre></div><p>getReference() ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì§„ì§œ ê°ì²´ê°€ ì•„ë‹Œ í•˜ì´ë²„ë„¤ì´íŠ¸ ë‚´ë¶€ ë¡œì§ìœ¼ë¡œ í”„ë¡ì‹œ ì—”í‹°í‹° ê°ì²´ ë°˜í™˜</p>
<p>ë‚´ë¶€ êµ¬ì¡°ëŠ” í‹€ì€ ê°™ì§€ë§Œ ë‚´ìš©ì´ ë¹„ì–´ìˆë‹¤.</p>
<figure><a class="lightgallery" href="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2022.png" title="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2022.png" data-thumbnail="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2022.png" data-sub-html="<h2>í”„ë¡ì‹œ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.</h2>">
        <img
            class="lazyload"
            src="/svg/loading.min.svg"
            data-src="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2022.png"
            data-srcset="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2022.png, https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2022.png 1.5x, https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2022.png 2x"
            data-sizes="auto"
            alt="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2022.png" />
    </a><figcaption class="image-caption">í”„ë¡ì‹œ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.</figcaption>
    </figure>
</li>
</ul>
<br>
<br>
<p><strong>íŠ¹ì§•</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2023.png"
        data-srcset="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2023.png, https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2023.png 1.5x, https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2023.png 2x"
        data-sizes="auto"
        alt="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2023.png"
        title="image" /></p>
<ul>
<li>
<p>ì‹¤ì œ í´ë˜ìŠ¤ë¥¼ìƒì†ë°›ì•„ì„œ ë§Œë“¤ì–´ì§</p>
</li>
<li>
<p>ì‹¤ì œ í´ë˜ìŠ¤ì™€ ê²‰ ëª¨ì–‘ì´ ê°™ë‹¤.</p>
</li>
<li>
<p>ì‚¬ìš©í•˜ëŠ” ì…ì¥ì—ì„œëŠ” ì§„ì§œ ê°ì²´ì¸ì§€ êµ¬ë¶„ í•„ìš”ê°€ ì—†ë‹¤. (ì´ë¡ ì ìœ¼ë¡œ)</p>
</li>
<li>
<p>í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ì˜ ì°¸ì¡°(target)ë¥¼ ë³´ê´€í•œë‹¤.</p>
</li>
<li>
<p>í”„ë¡ì‹œ ê°ì²´ë¥¼ í˜¸ì¶œ(getName())í•˜ë©´ í”„ë¡ì‹œ ê°ì²´ëŠ” ì‹¤ì œ ê°ì²´ì˜ ë©”ì†Œë“œ í˜¸ì¶œ</p>
</li>
<li>
<p>í”„ë¡ì‹œëŠ” ì²˜ìŒ ì‚¬ìš©í•  ë•Œ í•œ ë²ˆë§Œ ì´ˆê¸°í™”</p>
</li>
<li>
<p>í”„ë¡ì‹œ ê°ì²´ë¥¼ ì´ˆê¸°í™” í•  ë•Œ í”„ë¡ì‹œ ê°ì²´ê°€ ì‹¤ì œ ì—”í‹°í‹°ë¡œ ë°”ë€ŒëŠ” ê²ƒì€ ì•„ë‹˜, ì´ˆê¸°í™”ë˜ë©´ í”„ë¡ì‹œ ê°ì²´ë¥¼ í†µí•´
ì‹¤ì œ ì—”í‹°í‹°ì— ì ‘ê·¼ ê°€ëŠ¥</p>
</li>
<li>
<p>í”„ë¡ì‹œ ê°ì²´ëŠ” ì›ë³¸ ì—”í‹°í‹°ë¥¼ ìƒì†ë°›ìŒ, ë”°ë¼ì„œ íƒ€ì… ì²´í¬ì‹œ ì£¼ì˜í•´ì•¼í•¨( == ë¹„êµ ì‹¤íŒ¨, ëŒ€ì‹  instance of ì‚¬ìš©)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">m1</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="o">==</span> <span class="n">m2</span><span class="o">.</span><span class="na">getClass</span><span class="o">()</span> <span class="c1">//false
</span><span class="c1"></span><span class="n">m1</span> <span class="k">instanceof</span> <span class="n">Member</span>
<span class="n">m2</span> <span class="k">instanceof</span> <span class="n">Member</span>
</code></pre></div></li>
</ul>
<br>
<ul>
<li>
<p>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì°¾ëŠ” ì—”í‹°í‹°ê°€ ì´ë¯¸ ìˆìœ¼ë©´ em.getReference()ë¥¼ í˜¸ì¶œí•´ë„ ì‹¤ì œ ì—”í‹°í‹° ë°˜í™˜</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Member</span> <span class="n">m1</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">member1</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;m1 = &#34;</span><span class="o">+</span> <span class="n">m1</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span><span class="c1">//Member
</span><span class="c1"></span>
<span class="n">Member</span> <span class="n">reference</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">member1</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;reference = &#34;</span> <span class="n">reference</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span> <span class="c1">//Member
</span><span class="c1"></span>
<span class="n">m1</span> <span class="o">==</span> <span class="n">reference</span> <span class="c1">//true
</span></code></pre></div><p>ì´ë¯¸ Memberë¥¼ 1ì°¨ ìºì‹œì—ë„ ì˜¬ë¼ì™€ ìˆëŠ”ë°, í”„ë¡ì‹œë¥¼ ë°˜í™˜í•  í•„ìš”ê°€ ì—†ë‹¤.</p>
</li>
</ul>
<br>
<ul>
<li>
<p>ë°˜ëŒ€ë¡œ getReference()ë¡œ í”„ë¡ì‹œê°ì²´ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©´ ì‹¤ì œë¡œ find()ë¥¼ í–ˆì„ë•Œë„ í”„ë¡ì‹œ ê°ì²´ë¥¼ ë°˜í™˜í•¨</p>
</li>
<li>
<p>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ ë„ì›€ì„ ë°›ì„ ìˆ˜ ì—†ëŠ” ì¤€ì˜ì† ìƒíƒœì¼ ë•Œ, í”„ë¡ì‹œë¥¼ ì´ˆê¸°í™”í•˜ë©´ ë¬¸ì œ ë°œìƒ</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Member</span> <span class="n">refMember</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getReference</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">member</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;refMember = &#34;</span><span class="o">+</span> <span class="n">refMember</span><span class="o">.</span><span class="na">getClass</span><span class="o">());</span><span class="c1">//Proxy
</span><span class="c1"></span>
<span class="n">em</span><span class="o">.</span><span class="na">detach</span><span class="o">(</span><span class="n">refMember</span><span class="o">);</span>
<span class="c1">//em.clear
</span><span class="c1"></span>
<span class="n">refMember</span><span class="o">.</span><span class="na">getUsername</span><span class="o">();</span> <span class="c1">//org.hibernate.LazyInitializationException
</span></code></pre></div></li>
</ul>
<br>
<br>
<p><strong>í”„ë¡ì‹œ ê°ì²´ì˜ ì´ˆê¸°í™”</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="n">Member</span> <span class="n">member</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">getRefernce</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&#34;id1&#34;</span><span class="o">);</span><span class="c1">//(1)
</span><span class="c1"></span><span class="n">member</span><span class="o">.</span><span class="na">getName</span><span class="o">();</span><span class="c1">//(2)
</span></code></pre></div><p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2024.png"
        data-srcset="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2024.png, https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2024.png 1.5x, https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2024.png 2x"
        data-sizes="auto"
        alt="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2024.png"
        title="image" /></p>
<p>ì½”ë“œ 1ë¼ì¸ì—ì„œ getReference()ë¥¼ í˜¸ì¶œí•˜ë©´ í”„ë¡ì‹œê°ì²´ë¥¼ ê°€ì ¸ì˜¨ ë‹¤ìŒ, getName()ì„ í˜¸ì¶œí•˜ë©´</p>
<p>JPAê°€ ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— ì´ˆê¸°í™” ìš”ì²­ì„ í•œë‹¤.</p>
<p>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì—ì„œëŠ” ì‹¤ì œ DBë¥¼ ì¡°íšŒí•´ì„œ ê°€ì ¸ì˜¨ ë‹¤ìŒ ì‹¤ì œ Entityì— ê°’ì„ ë„£ì–´ ìƒì„±í•œ ë‹¤ìŒ í”„ë¡ì‹œ ê°ì²´ëŠ”</p>
<p>ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ì—°ê²°í•´ì„œ ì‹¤ì œ ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•œë‹¤.</p>
<p>ê·¸ ì´í›„ì—ëŠ” ì´ë¯¸ ì´ˆê¸°í™”ë˜ì–´ìˆëŠ” í”„ë¡ì‹œê°ì²´ ì—¬ê¸°ì— í•´ë‹¹ ì—”í‹°í‹°ë¥¼ ë°˜í™˜í•œë‹¤.</p>
<br>
<p><strong>í”„ë¡ì‹œ í™•ì¸</strong></p>
<ul>
<li>í”„ë¡ì‹œ ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ˆê¸°í™” ì—¬ë¶€ í™•ì¸
: PersistenceUnitUtil.isLoaded(Object entity) â†’ entityManagerFactory.getPersistenceUnitUtil().isLoaded(object)</li>
<li>í”„ë¡ì‹œ í´ë˜ìŠ¤ í™•ì¸ ë°©ë²•
: entity.getClass().getname() ì¶œë ¥(..javasist.. or HibernateProxy&hellip;)</li>
<li>í”„ë¡ì‹œ ê°•ì œ ì´ˆê¸°í™”
: org.hibernate.Hibernate.initialize(entity);</li>
<li>ì°¸ê³ : JPA í‘œì¤€ì€ ê°•ì œ ì´ˆê¸°í™” ì—†ìŒ
ê°•ì œí˜¸ì¶œ : method.getName();</li>
</ul>
<br>
<br>
<br>
<h2 id="2-ì¦‰ì‹œë¡œë”©ê³¼-ì§€ì—°ë¡œë”©">2. ì¦‰ì‹œë¡œë”©ê³¼ ì§€ì—°ë¡œë”©</h2>
<hr>
<h3 id="ì§€ì—°-ë¡œë”©">ì§€ì—° ë¡œë”©</h3>
<p>Memberë¥¼ ì¡°íšŒí•  ë•Œ Team(ì—°ê´€ê´€ê³„)ë„ í•¨ê»˜ ì¡°íšŒí•´ì•¼ í• ê¹Œ?
: ë‹¨ìˆœíˆ member ì •ë³´ë§Œì‚¬ìš©í•˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§</p>
<p><strong>ì§€ì—° ë¡œë”© LAZYì„ ì‚¬ìš©í•´ì„œ í”„ë¡ì‹œë¡œ ì¡°íšŒ</strong></p>
<br>
<p><strong><code>fetch = FetchType.LAZY</code></strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/*Member*/</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>

    <span class="o">...</span>
    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span> <span class="c1">//ì§€ì—°ë¡œë”© ì‚¬ìš©
</span><span class="c1"></span>    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;TEAM_ID&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Team</span> <span class="n">team</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>
<span class="n">Member</span> <span class="n">m</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">member1</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>  <span class="c1">// Member ê°ì²´ ë°˜í™˜
</span><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;m = &#34;</span><span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">getTeam</span><span class="o">().</span><span class="na">getClass</span><span class="o">());</span> <span class="c1">// Team$HibernateProxyê°ì²´ ë°˜í™˜
</span><span class="c1"></span><span class="n">m</span><span class="o">.</span><span class="na">getTeam</span><span class="o">().</span><span class="na">getName</span><span class="o">()</span>                               <span class="c1">// teamì„ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ì‹œì ì—ì„œ dbì¡°íšŒ ì—”í‹°í‹° ë°˜í™˜
</span><span class="c1"></span><span class="o">...</span>
</code></pre></div><p>ì—°ê´€ê´€ê³„ì— ìˆëŠ” ë‹¤ë¥¸ ì—”í‹°í‹°ë¥¼ ì‚¬ìš©í•˜ëŠ” ë¹ˆë„ìˆ˜ê°€ ë‚®ì„ ê²½ìš° ì§€ì—°ë¡œë”©ì„ ì‚¬ìš©í•´ ë¶ˆí•„ìš”í•œ ì—”í‹°í‹° ì¡°íšŒë¥¼ ë§‰ì„ ìˆ˜ ìˆë‹¤.</p>
<br>
<br>
<h3 id="ì¦‰ì‹œ-ë¡œë”©">ì¦‰ì‹œ ë¡œë”©</h3>
<p>â“Memberì™€ Teamì„ ê°™ì´ ì“°ëŠ” ë¹ˆë„ê°€ ë†’ì„ ê²½ìš°ì—ëŠ” ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œ?</p>
<br>
<br>
<p><strong>ì¦‰ì‹œ ë¡œë”© EAGERë¥¼ ì‚¬ìš©í•´ì„œ í•¨ê¼ ì¡°íšŒ
fetch = FetchType.EAGER</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/*Member*/</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span><span class="o">{</span>
    <span class="o">...</span>
    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="na">EAGER</span><span class="o">)</span> <span class="c1">//ì¦‰ì‹œë¡œë”© ì‚¬ìš©
</span><span class="c1"></span>    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;TEAM_ID&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Team</span> <span class="n">team</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>
<span class="n">Member</span> <span class="n">m</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">member1</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>  <span class="c1">// Member ê°ì²´ ë°˜í™˜
</span><span class="c1"></span><span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&#34;m = &#34;</span><span class="o">+</span> <span class="n">m</span><span class="o">.</span><span class="na">getTeam</span><span class="o">().</span><span class="na">getClass</span><span class="o">());</span> <span class="c1">// Team ê°ì²´ ë°˜í™˜
</span><span class="c1"></span><span class="o">...</span>
</code></pre></div><p>Memberë¥¼ ê°€ì ¸ì˜¤ëŠ” ì‹œì ì—ì„œ ì—°ê´€ê´€ê³„ì— ìˆëŠ” Teamê¹Œì§€ ë°”ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ì¦‰ì‹œ ë¡œë”©ì´ë¼ê³  í•œë‹¤.</p>
<br>
<br>
<h3 id="í”„ë¡ì‹œì™€-ì¦‰ì‹œë¡œë”©-ì£¼ì˜">í”„ë¡ì‹œì™€ ì¦‰ì‹œë¡œë”© ì£¼ì˜</h3>
<ul>
<li>ê°€ê¸‰ì ìœ¼ë¡œ ì§€ì—° ë¡œë”©ë§Œ ì‚¬ìš©(íŠ¹íˆ ì‹¤ë¬´ì—ì„œ)</li>
<li>ì¦‰ì‹œ ë¡œë”©ì„ ì ìš©í•˜ë©´ ì˜ˆìƒí•˜ì§€ ëª»í•œ SQLì´ ë°œìƒ <br>
<strong>ex</strong>: í•˜ë‚˜ì˜ ì—”í‹°í‹°ì— ì—°ê´€ëœ ì—”í‹°í‹°ê°€ ë‹¤ìˆ˜ë¼ë©´ find() í•œ ë²ˆ ìˆ˜í–‰ì‹œ ìˆ˜ì‹­ ìˆ˜ë°±ê°œì˜ í…Œì´ë¸”ì„ í•œë²ˆì—&hellip;</li>
<li>ì¦‰ì‹œ ë¡œë”©ì€ JPQLì—ì„œ N+1 ë¬¸ì œë¥¼ ì¼ìœ¼í‚¨ë‹¤. <br>
<strong>ex:</strong></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/*Member*/</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span><span class="o">{</span>
    <span class="o">...</span>
    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="na">EAGER</span><span class="o">)</span> <span class="c1">//ì¦‰ì‹œë¡œë”© ì‚¬ìš©
</span><span class="c1"></span>    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#34;TEAM_ID&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Team</span> <span class="n">team</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">&#34;select m from Member m&#34;</span><span class="o">,</span> <span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
				<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
<span class="c1">//SQL: select * from Member
</span><span class="c1">//SQL: select * from Team where TEAM_ID = xxx
</span><span class="c1"></span><span class="o">...</span>
</code></pre></div><p>ìœ„ JPQLì„ ê·¸ëŒ€ë¡œ ì¿¼ë¦¬ë¡œ ë²ˆì—­í•˜ê²Œ ë˜ë©´ Memberë¥¼ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ì¿¼ë¦¬ ìˆ˜í–‰ ì´í›„ ë°”ë¡œ Member ë‚´ë¶€ì˜ <br> Teamì„ ê°€ì ¸ì˜¤ê¸° ìœ„í•œ ì¿¼ë¦¬ë¥¼ ë‹¤ì‹œ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤ â†’ N+1(1ê°œì˜ ì¿¼ë¦¬ë¥¼ ë‚ ë¦¬ë©´ +Nê°œì˜ ì¿¼ë¦¬ê°€ ì¶”ê°€ìˆ˜í–‰ëœë‹¤)</p>
<p><em>ë§Œì•½, Teamê³¼ ê°™ì€ ì—°ê´€ê´€ê³„ê°€ ë” ìˆë‹¤ë©´?</em></p>
<ul>
<li>@ManyToOne, @OneToOneì€ ê¸°ë³¸ì´ ì¦‰ì‹œ ë¡œë”©ìœ¼ë¡œ ë˜ì–´ ìˆë‹¤.â†’ <strong>ì§ì ‘ ì „ë¶€ LAZYë¡œ ì„¤ì •</strong></li>
<li>@OneToMany, @ManyToManyëŠ” ê¸°ë³¸ì´ ì§€ì—° ë¡œë”©</li>
</ul>
<br>
<br>
<h3 id="n1ì˜-í•´ê²°ì±…">N+1ì˜ í•´ê²°ì±…</h3>
<ul>
<li>ìš°ì„  ì „ë¶€ ì§€ì—°ë¡œë”©ìœ¼ë¡œ ì„¤ì •í•œë‹¤.
ê·¸ ë‹¤ìŒ ê°€ì ¸ì™€ì•¼ í•˜ëŠ” ì—”í‹°í‹°ì— í•œí•´ì„œ fetch joinì„ ì‚¬ìš©í•´ì„œ ê°€ì ¸ì˜¨ë‹¤.</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"> <span class="n">List</span><span class="o">&lt;</span><span class="n">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">createQuery</span><span class="o">(</span><span class="s">&#34;select m from Member m join fetch m.team&#34;</span><span class="o">,</span> <span class="n">Member</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
 				<span class="o">.</span><span class="na">getResultList</span><span class="o">();</span>
</code></pre></div><p>ì´ë ‡ê²Œ JPQLì„ ì‹¤í–‰í•˜ë©´ <code>fetch join</code>ì„ í†µí•´ Team ë„ ê°€ì ¸ì™”ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ì—†ë‹¤.</p>
<br>
<br>
<h3 id="ì§€ì—°-ë¡œë”©-í™œìš©">ì§€ì—° ë¡œë”© í™œìš©</h3>
<ul>
<li>Memberì™€ Teamì€ ìì£¼ í•¨ê»˜ ì‚¬ìš© â†’ ì¦‰ì‹œ ë¡œë”©</li>
<li>memberì™€ OrderëŠ” ê°€ë” ì‚¬ìš© â†’ ì§€ì—° ë¡œë”©</li>
<li>Orderì™€ ProductëŠ” ìì£¼ í•¨ê»˜ ì‚¬ìš© â†’ ì¦‰ì‹œ ë¡œë”©</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2025.png"
        data-srcset="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2025.png, https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2025.png 1.5x, https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2025.png 2x"
        data-sizes="auto"
        alt="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2025.png"
        title="image" /></p>
<br>
<br>
<h3 id="ì§€ì—°-ë¡œë”©-í™œìš©---ì‹¤ë¬´">ì§€ì—° ë¡œë”© í™œìš© - ì‹¤ë¬´</h3>
<ul>
<li>
<p>ëª¨ë“  ì—°ê´€ê´€ê³„ì—ì„œ ì§€ì—° ë¡œë”©ì„ ì‚¬ìš©í•˜ì.</p>
</li>
<li>
<p>ì‹¤ë¬´ì—ì„œ ì¦‰ì‹œ ë¡œë”©ì„ ì‚¬ìš©í•˜ì§€ ë§ˆë¼.</p>
</li>
<li>
<p>JPQL fetch ì¡°ì¸ì´ë‚˜, ì—”í‹°í‹° ê·¸ë˜í”„ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ë¼.</p>
</li>
<li>
<p>ì¦‰ì‹œ ë¡œë”©ì€ ë‚´ê°€ ì˜ë„í•˜ì§€ ì•Šì€ ì¿¼ë¦¬ê°€ ìˆ˜í–‰ëœë‹¤.</p>
</li>
</ul>
<br>
<br>
<br>
<h2 id="3-ì˜ì†ì„±-ì „ì´-cascadì™€-ê³ ì•„-ê°ì²´">3. ì˜ì†ì„± ì „ì´ (CASCAD)ì™€ ê³ ì•„ ê°ì²´</h2>
<hr>
<p><strong>íŠ¹ì • ì—”í‹°í‹°ë¥¼ ì˜ì† ìƒíƒœë¡œ ë§Œë“¤ ë•Œ ì—°ê´€ëœ ì—”í‹°í‹°ë„ í•¨ê»˜ ì˜ì† ìƒíƒœë¡œ ë§Œë“¤ê³  ì‹¶ì„ ë•Œ ì‚¬ìš©.</strong> <br></p>
<ul>
<li><strong>Ex</strong>: ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ ì €ì¥í•  ë•Œ ìì‹ ì—”í‹°í‹°ë„ í•¨ê»˜ ì €ì¥.</li>
</ul>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2026.png"
        data-srcset="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2026.png, https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2026.png 1.5x, https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2026.png 2x"
        data-sizes="auto"
        alt="https://cdn.jsdelivr.net/gh/jaeyeonme/blog@main/static/images/JPA/Untitled%2026.png"
        title="image" /></p>
<br>
<br>
<p><strong>ì˜ì†ì„± ì „ì´: ì €ì¥</strong></p>
<ul>
<li>
<p>ì˜ì†ì„± ì „ì´ê°€ ì•ˆë˜ëŠ” ê¸°ë³¸ì ì¸ ì—”í‹°í‹° ì €ì¥ ë°©ë²•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/*ì˜ì†ì„± ì „ì´ê°€ ì•ˆë˜ëŠ” ì—”í‹°í‹° ì €ì¥ ë°©ë¹•*/</span>
<span class="o">...</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span><span class="o">{</span>
<span class="o">...</span>
<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&#34;parent&#34;</span><span class="o">)</span>
<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Child</span><span class="o">&gt;</span> <span class="n">childList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addChild</span><span class="o">(</span><span class="n">Child</span> <span class="n">child</span><span class="o">){</span>
    <span class="n">childList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">child</span><span class="o">);</span>
    <span class="n">child</span><span class="o">.</span><span class="na">setParent</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
<span class="o">}</span>
<span class="o">...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span><span class="o">{</span>
    <span class="o">...</span>
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;parent_id&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Parent</span> <span class="n">parent</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>
<span class="n">Child</span> <span class="n">child1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Child</span><span class="o">();</span>
<span class="n">Child</span> <span class="n">child2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Child</span><span class="o">();</span>
<span class="n">Parent</span> <span class="n">parent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Parent</span><span class="o">();</span>
<span class="n">parent</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">child1</span><span class="o">);</span>
<span class="n">parent</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">child2</span><span class="o">);</span>

<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">child1</span><span class="o">);</span>
<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">child2</span><span class="o">);</span> <span class="c1">// persistë¥¼ 3ë²ˆì´ë‚˜ í•´ì•¼í•œë‹¤.
</span></code></pre></div><p>ìœ„ì™€ ê°™ì´ persistë¥¼ ì„¸ ë²ˆ í˜¸ì¶œí•´ì•¼ ì •ìƒì ìœ¼ë¡œ ë™ì‘ì„ í•œë‹¤. ì•„ì£¼ ì•„ë¦„ë‹µì§€ ì•Šì€&lt;?&gt; ì½”ë“œì´ë‹¤.</p>
<p>persist í•œ ë²ˆìœ¼ë¡œ child ê¹Œì§€ ê°™ì´ persistëŠ” ë¶ˆê°€ëŠ¥í•œê°€?</p>
</li>
</ul>
<br>
<br>
<ul>
<li>
<p>ì˜ì†ì • ì „ì´(CASCADE)ë¥¼ ì´ìš©í•œ ì—”í‹°í‹° ì €ì¥ ë°©ë²•</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="cm">/*ì˜ì†ì„± ì „ì´ê°€ ì•ˆë˜ëŠ” ì—”í‹°í‹° ì €ì¥ ë°©ë¹•*/</span>
<span class="o">...</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span><span class="o">{</span>
	<span class="o">...</span>
	<span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&#34;parent&#34;</span><span class="o">,</span> <span class="n">cascade</span><span class="o">=</span><span class="n">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span><span class="c1">//ì˜ì†ì„± ì „ì´ ì†ì„±(CASCADE)ì‚¬ìš©
</span><span class="c1"></span>	<span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Child</span><span class="o">&gt;</span> <span class="n">childList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

	<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addChild</span><span class="o">(</span><span class="n">Child</span> <span class="n">child</span><span class="o">){</span>
		<span class="n">childList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">child</span><span class="o">);</span>
		<span class="n">child</span><span class="o">.</span><span class="na">setParent</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
	<span class="o">}</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span><span class="o">{</span>
	<span class="o">...</span>
	<span class="nd">@ManyToOne</span>
	<span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;parent_id&#34;</span><span class="o">)</span>
	<span class="kd">private</span> <span class="n">Parent</span> <span class="n">parent</span><span class="o">;</span>
	<span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>
<span class="n">Child</span> <span class="n">child1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Child</span><span class="o">();</span>
<span class="n">Child</span> <span class="n">child2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Child</span><span class="o">();</span>
<span class="n">Parent</span> <span class="n">parent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Parent</span><span class="o">();</span>
<span class="n">parent</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">child1</span><span class="o">);</span>
<span class="n">parent</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">child2</span><span class="o">);</span>

<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span><span class="c1">// parentë§Œ persist í•´ì£¼ë‹ˆ childë„ ê°™ì´ persistëœë‹¤.
</span></code></pre></div><p>parentë§Œ persistí•´ì£¼ë‹ˆ ê·¸ì— ê´€ë ¨ëœ childListë“¤ë„ ê°™ì´ persistê°€ ëœë‹¤.</p>
</li>
</ul>
<br>
<br>
<p><strong>CASCADEì˜ ì¢…ë¥˜</strong></p>
<ul>
<li><code>ALL</code> : ëª¨ë‘ ì ìš©(ëª¨ë“  ê³³ì—ì„œ ë§ì¶°ì•¼ í•˜ë©´ í•´ë‹¹ ì˜µì…˜)</li>
<li><code>PERSIST</code> : ì˜ì†(ì €ì¥í•  ë•Œë§Œ ì‚¬ìš©í•  ê²ƒì´ë¼ë©´ í•´ë‹¹ ì˜µì…˜)</li>
<li><code>REMOVE</code> : ì‚­ì œ</li>
<li><code>MERGE</code> : ë³‘í•©</li>
<li><code>REFRESH</code> : REFRESH</li>
<li><code>DETACH</code> : DETACH</li>
</ul>
<br>
<br>
<h3 id="ì˜ì†ì„±-ì „ì´cascadeëŠ”-ì–¸ì œ-ì¨ì•¼-í• ê¹Œ">ì˜ì†ì„± ì „ì´(CASCADE)ëŠ” ì–¸ì œ ì¨ì•¼ í• ê¹Œ?</h3>
<p>: ì „ì´ ë  ëŒ€ìƒì´ í•œ êµ°ë°ì—ì„œë§Œ ì‚¬ìš©ëœë‹¤ë©´ ì¨ë„ ëœë‹¤.</p>
<p>í•˜ì§€ë§Œ, í•´ë‹¹ ì—”í‹°í‹°(Child)ê°€ íŠ¹ì • ì—”í‹°í‹°(Parent)ì— ì¢…ì†ë˜ì§€ ì•Šê³  ì—¬ëŸ¬êµ°ë°ì„œ ì‚¬ìš©ëœë‹¤ë©´</p>
<p>ì‚¬ìš”í•˜ì§€ ì•ŠëŠ”ê²Œ ì¢‹ë‹¤.</p>
<ul>
<li>ë¼ì´í”„ ì‚¬ì´í´ì´ ë™ì¼í•  ë•Œ</li>
<li>ë‹¨ì¼ ì†Œìœ ì ê´€ê³„ì¼ ë•Œ</li>
</ul>
<br>
<br>
<dl>
<dt><strong>ê³ ì•„ ê°ì²´</strong></dt>
<dd>
<p>ê³ ì•„ ê°ì²´ ì œê±°: ë¶€ëª¨ ì—”í‹°í‹°ì™€ ì—°ê´€ê´€ê³„ê°€ ëŠì–´ì§„ ìì‹ ì—”í‹°í‹°ë¥¼ ìë™ìœ¼ë¡œ ì‚­ì œ</p>
</dd>
</dl>
<ul>
<li>
<p>orphanRemoval = true</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Parent</span> <span class="o">{</span>

    <span class="o">...</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">&#34;parent&#34;</span><span class="o">,</span> <span class="n">cascade</span><span class="o">=</span><span class="n">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Child</span><span class="o">&gt;</span> <span class="n">childList</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">addChild</span><span class="o">(</span><span class="n">Child</span> <span class="n">child</span><span class="o">){</span>
        <span class="n">childList</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">child</span><span class="o">);</span>
        <span class="n">child</span><span class="o">.</span><span class="na">setParent</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Child</span><span class="o">{</span>

    <span class="o">...</span>
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;parent_id&#34;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">Parent</span> <span class="n">parent</span><span class="o">;</span>
    <span class="o">...</span>
<span class="o">}</span>

<span class="o">...</span>
<span class="n">Child</span> <span class="n">child1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Child</span><span class="o">();</span>
<span class="n">Child</span> <span class="n">child2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Child</span><span class="o">();</span>
<span class="n">Parent</span> <span class="n">parent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Parent</span><span class="o">();</span>
<span class="n">parent</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">child1</span><span class="o">);</span>
<span class="n">parent</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">child2</span><span class="o">);</span>

<span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span><span class="c1">// parentë§Œ persist í•´ì£¼ë‹ˆ childë„ ê°™ì´ persistëœë‹¤.
</span><span class="c1"></span>
<span class="n">em</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
<span class="n">em</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>

<span class="n">Parent</span> <span class="n">findParent</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="n">Parent</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">parent</span><span class="o">.</span><span class="na">getId</span><span class="o">());</span>
<span class="n">findParent</span><span class="o">.</span><span class="na">getChildList</span><span class="o">().</span><span class="na">remove</span><span class="o">(</span><span class="n">0</span><span class="o">);</span> <span class="c1">// orphanRemoval ë™ì‘
</span></code></pre></div></li>
</ul>
<br>
<p><strong>ê³ ì•„ ê°ì²´ - ì£¼ì˜</strong></p>
<ul>
<li>ì°¸ì¡°ê°€ ì œê±°ëœ ì—”í‹°í‹°ëŠ” ë‹¤ë¥¸ ê³³ì—ì„œ ì°¸ì¡°í•˜ì§€ ì•ŠëŠ” ê³ ì•„ ê°ì²´ë¡œ ë³´ê³  ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥</li>
<li>ì°¸ì¡°í•˜ëŠ” ê³ ì´ í•˜ë‚˜ì¼ ë•Œ ì‚¬ìš©í•´ì•¼ í•¨</li>
<li>íŠ¹ì • ì—”í‹°í‹°ê°€ ê°œì¸ ì†Œìœ í•  ë•Œ ì‚¬ìš©</li>
<li>@OneToOne, @OneToManyë§Œ ê°€ëŠ¥</li>
<li>ì°¸ê³ : ê°œë…ì ìœ¼ë¡œ ë¶€ëª¨ë¥¼ ì œê±°í•˜ë©´ ìì‹ì€ ê³ ì•„ê°€ ëœë‹¤. ë”°ë¼ì„œ ê³ ì•„ ê°ì²´ ì œê±° ê¸°ëŠ¥ì„ í™œì„±í™” í•˜ë©´,
ë¶€ëª¨ë¥¼ ì œê±°í•  ë•Œ ìì‹ë„ í•¨ê»˜ ì œê±°ëœë‹¤. ë§ˆì¹˜ CAscadeType.REMOVEì²˜ëŸ¼ ë™ì‘í•œë‹¤.</li>
<li>Parentê°ì²´ë¥¼ ì§€ìš°ê²Œ ë˜ë©´ Parentê°€ ì†Œìœ í•˜ê³ ìˆëŠ” ChildListì— ì†í•œì—”í‹°í‹°ë“¤ì´ ì „ë¶€ ê°™ì´ ì‚­ì œëœë‹¤.</li>
</ul>
<br>
<br>
<p><strong>ì˜ì†ì„± ì „ì´ + ê³ ì•„ ê°ì²´, ìƒëª… ì£¼ê¸°
(CascadeType.ALL + orphanRemoval=true)</strong></p>
<ul>
<li>ìŠ¤ìŠ¤ë¡œ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ëŠ” ì—”í‹°í‹°ëŠ” em.persist()ë¡œ ì˜ì†í™”, em.remove()ë¡œ ì œê±°</li>
<li>ë‘ ì˜µì…˜ì„ ëª¨ë‘ í™œì„±í™” í•˜ë©´ ë¶€ëª¨ ì—”í‹°í‹°ë¥¼ í†µí•´ì„œ ìì‹ì˜ ìƒëª…ì£¼ê¸° ê´€ë¦¬ê°€ ê°€ëŠ¥í•˜ë‹¤.</li>
<li>ë„ë©”ì¸ ì£¼ê³  ì„¤ê³„(DDD)ì˜ Aggregate Root ê°œë…ì„ êµ¬í˜„í•  ë•Œ ìœ ìš©</li>
</ul>
<br>
<br>
<p><strong>ì°¸ê³ : Aggregate Rootê°œë…ì„ ì•Œê¸° ìœ„í•´ ìš°ì„  Aggregateë¥¼ ì„¤ëª…í•´ì•¼ í•œë‹¤.</strong></p>
<p>ì—°ê´€ê¹Šì€ ë„ë©”ì¸ë“¤ì„ ê°ê°ì´ ì•„ë‹Œ í•˜ë‚˜ì˜ ì§‘í•©ìœ¼ë¡œ ë‹¤ë£¨ëŠ” ê²ƒì„ Aggregateë¼ í•œë‹¤.  <br> ì¦‰ ë°ì´í„° ë³€ê²½ì˜ ë‹¨ìœ„ë¡œ ë‹¤ë£¨ëŠ” ì—°ê´€ ê°ì²´ì˜ë¬¶ìŒ.<br>Aggregateì—ëŠ” ë£¨íŠ¸(root)ì™€ ê²½ê³„(boundary)ê°€ ìˆëŠ”ë°, ê²½ê³„ëŠ” Aggregateì— ë¬´ì—‡ì´ í¬í•¨ë˜ê³  í¬í•¨ë˜ì§€ ì•ŠëŠ”ì§€ë¥¼ ì •ì˜í•œë‹¤. <br>
ë£¨íŠ¸ëŠ” ë‹¨ í•˜ë‚˜ë§Œ ì¡´ì¬í•˜ë©°, Aggregateì— í¬í•¨ëœ íŠ¹ì • ì—”í‹°í‹°ë¥¼ ê°€ë¥´í‚¨ë‹¤. <br>
ê²½ê³„ì•ˆì˜ ê°ì²´ëŠ” ì„œë¡œ ì°¸ì¡°ê°€ ê°€ëŠ¥í•˜ì§€ë§Œ, ê²½ê³„ë°–ì˜ ê°ì²´ëŠ” í•´ë‹¹ Aggregateì˜ êµ¬ì„±ìš”ì†Œ ê°€ìš´ë° ë£¨íŠ¸ë§Œ ì°¸ì¡°í•  ìˆ˜ ìˆë‹¤. <br></p>
<p>ì°¸ê³ : DDDì—ì„œ ë£¨íŠ¸ ì—”í‹°í‹°ëŠ” ì „ì—­ ì‹ë³„ì„± Global Identityì„ ê°€ì§„ ì—”í‹°í‹°ë¼ê³  í•©ë‹ˆë‹¤. <br></p>
<ul>
<li><strong>Ex)</strong>  ì£¼ë¬¸ì‹œìŠ¤í…œì˜ Order Entity</li>
</ul>
<br>
<br>
<br>
</div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2021-12-29</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="Share on Twitter" data-sharer="twitter" data-url="https://jaeyeonme.github.io/posts/jpa-proxy-and-management/" data-title="í”„ë¡ì‹œì™€ ì—°ê´€ê´€ê³„ ê´€ë¦¬" data-hashtags="JPA,Hibernate"><i class="fab fa-twitter fa-fw"></i></a><a href="javascript:void(0);" title="Share on Facebook" data-sharer="facebook" data-url="https://jaeyeonme.github.io/posts/jpa-proxy-and-management/" data-hashtag="JPA"><i class="fab fa-facebook-square fa-fw"></i></a><a href="javascript:void(0);" title="Share on Linkedin" data-sharer="linkedin" data-url="https://jaeyeonme.github.io/posts/jpa-proxy-and-management/"><i class="fab fa-linkedin fa-fw"></i></a><a href="javascript:void(0);" title="Share on Blogger" data-sharer="blogger" data-url="https://jaeyeonme.github.io/posts/jpa-proxy-and-management/" data-title="í”„ë¡ì‹œì™€ ì—°ê´€ê´€ê³„ ê´€ë¦¬" data-description=""><i class="fab fa-blogger fa-fw"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/jpa/">JPA</a>,&nbsp;<a href="/tags/hibernate/">Hibernate</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/posts/jpa-advanced-mapping/" class="prev" rel="prev" title="ê³ ê¸‰ ë§¤í•‘"><i class="fas fa-angle-left fa-fw"></i>ê³ ê¸‰ ë§¤í•‘</a>
            <a href="/posts/jpa-value-type/" class="next" rel="next" title="ê°’ íƒ€ì…">ê°’ íƒ€ì…<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id="comments"><script src="https://utteranc.es/client.js"
                        repo="jaeyeonme/blog_comments"
                        issue-term="pathname"
                        theme="preferred-color-scheme"
                        crossorigin="anonymous"
                        async>
                </script><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://utteranc.es/">Utterances</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">Powered by <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.91.2">Hugo</a> | Theme - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
                </div><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2021 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Jaeyeon</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="Back to Top">
                <i class="fas fa-arrow-up fa-fw"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
                <i class="fas fa-comment fa-fw"></i>
            </a>
        </div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/css/lightgallery.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/smooth-scroll@16.1.3/dist/smooth-scroll.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.2.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.2.0/dist/js/lightgallery.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.2.0/dist/lg-zoom.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.0/sharer.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":500},"comment":{"utterances":{"darkTheme":"github-dark","issueTerm":"pathname","label":"","lightTheme":"github-light","repo":"jaeyeonme/blog_comments"}},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true}};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
